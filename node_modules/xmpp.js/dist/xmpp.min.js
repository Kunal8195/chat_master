!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).xmpp=t()}}(function(){return function t(e,n,r){function o(s,a){if(!n[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[s]={exports:{}};e[s][0].call(l.exports,function(t){var n=e[s][1][t];return o(n||t)},l,l.exports,t,e,n,r)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(t,e,n){"use strict"},{}],2:[function(t,e,n){"use strict";function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function o(t){return"function"==typeof t}function i(t){return"number"==typeof t}function s(t){return"object"===(void 0===t?"undefined":u(t))&&null!==t}function a(t){return void 0===t}var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};e.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(t){if(!i(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},r.prototype.emit=function(t){var e,n,r,i,u,c;if(this._events||(this._events={}),"error"===t&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var l=new Error('Uncaught, unspecified "error" event. ('+e+")");throw l.context=e,l}if(n=this._events[t],a(n))return!1;if(o(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:i=Array.prototype.slice.call(arguments,1),n.apply(this,i)}else if(s(n))for(i=Array.prototype.slice.call(arguments,1),r=(c=n.slice()).length,u=0;u<r;u++)c[u].apply(this,i);return!0},r.prototype.addListener=function(t,e){var n;if(!o(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,o(e.listener)?e.listener:e),this._events[t]?s(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,s(this._events[t])&&!this._events[t].warned&&(n=a(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[t].length>n&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(t,e){function n(){this.removeListener(t,n),r||(r=!0,e.apply(this,arguments))}if(!o(e))throw TypeError("listener must be a function");var r=!1;return n.listener=e,this.on(t,n),this},r.prototype.removeListener=function(t,e){var n,r,i,a;if(!o(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=this._events[t],i=n.length,r=-1,n===e||o(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(s(n)){for(a=i;a-- >0;)if(n[a]===e||n[a].listener&&n[a].listener===e){r=a;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},r.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[t],o(n))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},r.prototype.listeners=function(t){return this._events&&this._events[t]?o(this._events[t])?[this._events[t]]:this._events[t].slice():[]},r.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(o(e))return 1;if(e)return e.length}return 0},r.listenerCount=function(t,e){return t.listenerCount(e)}},{}],3:[function(t,e,n){"use strict";"function"==typeof Object.create?e.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},{}],4:[function(t,e,n){"use strict";function r(t,e){this.name=t,this.parent=null,this.children=[],this.attrs={},this.setAttrs(e)}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=t("./escape"),s=i.escapeXML,a=i.escapeXMLText,u=t("./equal"),c=u.equal,l=u.name,p=u.attrs,f=u.children,h=t("./clone");r.prototype.is=function(t,e){return this.getName()===t&&(!e||this.getNS()===e)},r.prototype.getName=function(){return this.name.indexOf(":")>=0?this.name.substr(this.name.indexOf(":")+1):this.name},r.prototype.getNS=function(){if(this.name.indexOf(":")>=0){var t=this.name.substr(0,this.name.indexOf(":"));return this.findNS(t)}return this.findNS()},r.prototype.findNS=function(t){if(t){var e="xmlns:"+t;if(this.attrs[e])return this.attrs[e];if(this.parent)return this.parent.findNS(t)}else{if(this.attrs.xmlns)return this.attrs.xmlns;if(this.parent)return this.parent.findNS()}},r.prototype.getXmlns=function(){var t={};this.parent&&(t=this.parent.getXmlns());for(var e in this.attrs){var n=e.match("xmlns:?(.*)");this.attrs.hasOwnProperty(e)&&n&&(t[this.attrs[e]]=n[1])}return t},r.prototype.setAttrs=function(t){"string"==typeof t?this.attrs.xmlns=t:t&&Object.keys(t).forEach(function(e){this.attrs[e]=t[e]},this)},r.prototype.getAttr=function(t,e){if(!e)return this.attrs[t];var n=this.getXmlns();return n[e]?this.attrs[[n[e],t].join(":")]:null},r.prototype.getChild=function(t,e){return this.getChildren(t,e)[0]},r.prototype.getChildren=function(t,e){for(var n=[],r=0;r<this.children.length;r++){var o=this.children[r];!o.getName||o.getName()!==t||e&&o.getNS()!==e||n.push(o)}return n},r.prototype.getChildByAttr=function(t,e,n,r){return this.getChildrenByAttr(t,e,n,r)[0]},r.prototype.getChildrenByAttr=function(t,e,n,r){for(var o=[],i=0;i<this.children.length;i++){var s=this.children[i];!s.attrs||s.attrs[t]!==e||n&&s.getNS()!==n||o.push(s),r&&s.getChildrenByAttr&&o.push(s.getChildrenByAttr(t,e,n,!0))}return r&&(o=[].concat.apply([],o)),o},r.prototype.getChildrenByFilter=function(t,e){for(var n=[],r=0;r<this.children.length;r++){var o=this.children[r];t(o)&&n.push(o),e&&o.getChildrenByFilter&&n.push(o.getChildrenByFilter(t,!0))}return e&&(n=[].concat.apply([],n)),n},r.prototype.getText=function(){for(var t="",e=0;e<this.children.length;e++){var n=this.children[e];"string"!=typeof n&&"number"!=typeof n||(t+=n)}return t},r.prototype.getChildText=function(t,e){var n=this.getChild(t,e);return n?n.getText():null},r.prototype.getChildElements=function(){return this.getChildrenByFilter(function(t){return t instanceof r})},r.prototype.root=function(){return this.parent?this.parent.root():this},r.prototype.tree=r.prototype.root,r.prototype.up=function(){return this.parent?this.parent:this},r.prototype.c=function(t,e){return this.cnode(new r(t,e))},r.prototype.cnode=function(t){return this.children.push(t),"object"===(void 0===t?"undefined":o(t))&&(t.parent=this),t},r.prototype.t=function(t){return this.children.push(t),this},r.prototype.remove=function(t,e){var n;return n="string"==typeof t?function(n){return!(n.is&&n.is(t,e))}:function(e){return e!==t},this.children=this.children.filter(n),this},r.prototype.clone=function(){return h(this)},r.prototype.text=function(t){return t&&1===this.children.length?(this.children[0]=t,this):this.getText()},r.prototype.attr=function(t,e){return void 0!==e||null===e?(this.attrs||(this.attrs={}),this.attrs[t]=e,this):this.attrs[t]},r.prototype.toString=function(){var t="";return this.write(function(e){t+=e}),t},r.prototype.toJSON=function(){return{name:this.name,attrs:this.attrs,children:this.children.map(function(t){return t&&t.toJSON?t.toJSON():t})}},r.prototype._addChildren=function(t){t(">");for(var e=0;e<this.children.length;e++){var n=this.children[e];(n||0===n)&&(n.write?n.write(t):"string"==typeof n?t(a(n)):n.toString&&t(a(n.toString(10))))}t("</"),t(this.name),t(">")},r.prototype.write=function(t){t("<"),t(this.name);for(var e in this.attrs){var n=this.attrs[e];null!=n&&(t(" "),t(e),t('="'),"string"!=typeof n&&(n=n.toString()),t(s(n)),t('"'))}0===this.children.length?t("/>"):this._addChildren(t)},r.prototype.nameEquals=function(t){return l(this,t)},r.prototype.attrsEquals=function(t){return p(this,t)},r.prototype.childrenEquals=function(t){return f(this,t)},r.prototype.equals=function(t){return c(this,t)},e.exports=r},{"./clone":5,"./equal":6,"./escape":7}],5:[function(t,e,n){"use strict";e.exports=function(t){for(var e=new t.constructor(t.name,t.attrs),n=0;n<t.children.length;n++){var r=t.children[n];e.cnode(r.clone?r.clone():r)}return e}},{}],6:[function(t,e,n){"use strict";function r(t,e){return t.name===e.name}function o(t,e){var n=t.attrs,r=Object.keys(n),o=r.length;if(o!==Object.keys(e.attrs).length)return!1;for(var i=0,s=o;i<s;i++){var a=r[i],u=n[a];if(null==u||null==e.attrs[a]){if(u!==e.attrs[a])return!1}else if(u.toString()!==e.attrs[a].toString())return!1}return!0}function i(t,e){var n=t.children,r=n.length;if(r!==e.children.length)return!1;for(var o=0,i=r;o<i;o++){var s=n[o];if("string"==typeof s){if(s!==e.children[o])return!1}else if(!s.equals(e.children[o]))return!1}return!0}e.exports.name=r,e.exports.attrs=o,e.exports.children=i,e.exports.equal=function(t,e){return!!r(t,e)&&!!o(t,e)&&!!i(t,e)}},{}],7:[function(t,e,n){"use strict";function r(t){return i[t]}function o(t){return s[t]}var i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;"},s={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&quot;":'"',"&#34;":'"',"&apos;":"'","&#39;":"'"};n.escapeXML=function(t){return t.replace(/&|<|>|"|'/g,r)},n.unescapeXML=function(t){return t.replace(/&(amp|#38|lt|#60|gt|#62|quot|#34|apos|#39);/g,o)},n.escapeXMLText=function(t){return t.replace(/&|<|>/g,r)},n.unescapeXMLText=function(t){return t.replace(/&(amp|#38|lt|#60|gt|#62);/g,o)}},{}],8:[function(t,e,n){"use strict";var r=t("inherits"),o=t("events").EventEmitter,i=t("../escape").unescapeXML,s=e.exports=function(){o.call(this);var t,e,n,r,s,a,u,c=0,l=0;this._handleTagOpening=function(t,e,n){t?this.emit("endElement",e):(this.emit("startElement",e,n),s&&this.emit("endElement",e))},this.write=function(o){function p(){if("number"==typeof l){var t=o.slice(l,f);return l=void 0,t}}"string"!=typeof o&&(o=o.toString());var f=0;for(t&&(o=t+o,f+=t.length,t=null);f<o.length;f++){var h=o.charCodeAt(f);switch(c){case 0:if(60===h){var m=p();m&&this.emit("text",i(m)),c=3,l=f+1,n={}}break;case 9:if(93===h&&"]>"===o.substr(f+1,2)){var y=p();y&&this.emit("text",y),c=1}break;case 3:47===h&&l===f?(l=f+1,r=!0):33===h?"[CDATA["===o.substr(f+1,7)?(l=f+8,c=9):(l=void 0,c=1):63===h?(l=void 0,c=2):(h<=32||47===h||62===h)&&(e=p(),f--,c=4);break;case 1:if(62===h){var d=o.charCodeAt(f-1),v=o.charCodeAt(f-2);(45===d&&45===v||93===d&&93===v)&&(c=0)}break;case 2:62===h&&63===o.charCodeAt(f-1)&&(c=0);break;case 4:62===h?(this._handleTagOpening(r,e,n),e=void 0,n=void 0,r=void 0,s=void 0,c=0,l=f+1):47===h?s=!0:h>32&&(l=f,c=5);break;case 5:(h<=32||61===h)&&(u=p(),f--,c=6);break;case 6:61===h&&(c=7);break;case 7:34!==h&&39!==h||(a=h,c=8,l=f+1);break;case 8:if(h===a){var b=i(p());n[u]=b,u=void 0,c=4}}}"number"==typeof l&&l<=o.length&&(t=o.slice(l),l=0)}};r(s,o),s.prototype.end=function(t){t&&this.write(t),this.write=function(){}}},{"../escape":7,events:2,inherits:3}],9:[function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,o){"object"===(void 0===n?"undefined":r(n))&&o(n,e)}(0,function(t,e){function n(){}n.prototype.name="ANONYMOUS",n.prototype.clientFirst=!0,n.prototype.response=function(t){return t.trace||""},n.prototype.challenge=function(t){},e.exports=n})},{}],10:[function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(o,i){"object"===(void 0===n?"undefined":r(n))&&i(n,e,t("./lib/mechanism"))}(0,function(t,e,n){(e.exports=n).Mechanism=n})},{"./lib/mechanism":9}],11:[function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,o){"object"===(void 0===n?"undefined":r(n))&&o(n,e)}(0,function(t,e){function n(){}n.prototype.name="PLAIN",n.prototype.clientFirst=!0,n.prototype.response=function(t){var e="";return e+=t.authzid||"",e+="\0",e+=t.username,e+="\0",e+=t.password},n.prototype.challenge=function(t){return this},e.exports=n})},{}],12:[function(t,e,n){arguments[4][10][0].apply(n,arguments)},{"./lib/mechanism":11,dup:10}],13:[function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,o){"object"===(void 0===n?"undefined":r(n))&&o(n,e)}(0,function(t,e){function n(){this._mechs=[]}n.prototype.use=function(t,e){return e||(t=(e=t).prototype.name),this._mechs.push({name:t,mech:e}),this},n.prototype.create=function(t){for(var e=0,n=this._mechs.length;e<n;e++)for(var r=0,o=t.length;r<o;r++){var i=this._mechs[e];if(i.name==t[r])return new i.mech}return null},e.exports=n})},{}],14:[function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(o,i){"object"===(void 0===n?"undefined":r(n))&&i(n,e,t("./lib/factory"))}(0,function(t,e,n){(e.exports=n).Factory=n})},{"./lib/factory":13}],15:[function(t,e,n){"use strict";var r=t("./lib/Client"),o=t("@xmpp/xml"),i=t("@xmpp/jid");e.exports.Client=r,e.exports.xml=o,e.exports.jid=i},{"./lib/Client":16,"@xmpp/jid":24,"@xmpp/xml":43}],16:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function t(e,n,r){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,r)}if("value"in o)return o.value;var s=o.get;if(void 0!==s)return s.call(r)},u=t("@xmpp/connection"),c=function(t){function e(t){r(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.transports=[],n}return i(e,u),s(e,[{key:"send",value:function(t){var n;!t.attrs.xmlns&&(t.is("iq")||t.is("message")||t.is("presence"))&&(t.attrs.xmlns="jabber:client");for(var r=arguments.length,o=Array(r>1?r-1:0),i=1;i<r;i++)o[i-1]=arguments[i];return(n=a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"send",this)).call.apply(n,[this,t].concat(o))}},{key:"connect",value:function(t){var n=this.transports.find(function(e){try{return void 0!==e.prototype.socketParameters(t)}catch(t){return!1}});if(!n)throw new Error("No compatible connection method found.");return this.Transport=n,this.Socket=n.prototype.Socket,this.Parser=n.prototype.Parser,a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"connect",this).call(this,t)}},{key:"socketParameters",value:function(){var t;return(t=this.Transport.prototype).socketParameters.apply(t,arguments)}},{key:"header",value:function(){var t;return(t=this.Transport.prototype).header.apply(t,arguments)}},{key:"headerElement",value:function(){var t;return(t=this.Transport.prototype).headerElement.apply(t,arguments)}},{key:"footer",value:function(){var t;return(t=this.Transport.prototype).footer.apply(t,arguments)}},{key:"footerElement",value:function(){var t;return(t=this.Transport.prototype).footerElement.apply(t,arguments)}}]),e}();c.prototype.NS="jabber:client",e.exports=c},{"@xmpp/connection":17}],17:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t){if(y.parse){var e=y.parse(t);return e.hostname||e.pathname}var n=document.createElement("a");return n.href=t,n.hostname}var a=function(){function t(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var s,a=t[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(o)throw i}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),l=t("@xmpp/events"),p=l.timeout,f=l.EventEmitter,h=l.promise,m=t("@xmpp/jid"),y=t("url"),d=t("@xmpp/xml"),v=function(t){function e(t,n,i){r(this,e);var s=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t+(n?" - "+n:"")));return s.name="XMPPError",s.condition=t,s.text=n,s.element=i,s}return i(e,Error),e}(),b=function(t){function e(){var t;r(this,e);for(var n=arguments.length,i=Array(n),s=0;s<n;s++)i[s]=arguments[s];var a=o(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(i)));return a.name="StreamError",a}return i(e,v),e}(),g=function(t){function e(t){r(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.domain="",n.lang="",n.jid=null,n.timeout=2e3,n.options="object"===(void 0===t?"undefined":u(t))?t:{},n.plugins=Object.create(null),n.startOptions=null,n.openOptions=null,n.connectOptions=null,n.socketListeners=Object.create(null),n.parserListeners=Object.create(null),n.status="offline",n}return i(e,f),c(e,[{key:"_reset",value:function(){this.domain="",this.lang="",this.jid=null,this._detachSocket(),this._detachParser(),this.socket=null}},{key:"_attachSocket",value:function(t){var e=this,n=this.socket=t,r=this.socketListeners;r.data=function(t){var n=t.toString("utf8");e.emit("input",n),e.parser.write(n)},r.close=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];e._reset(),e._status.apply(e,["disconnect"].concat(n))},r.connect=function(){e._status("connect"),n.once("close",r.close)},r.error=function(t){e._reset(),"connecting"===e.status&&e._status("offline"),e.emit("error",t)},n.on("data",r.data),n.on("error",r.error),n.on("connect",r.connect)}},{key:"_detachSocket",value:function(){var t=this,e=this.socketListeners;Object.getOwnPropertyNames(e).forEach(function(n){t.socket.removeListener(n,e[n]),delete e[n]}),delete this.socket}},{key:"_attachParser",value:function(t){var e=this,n=this.parser=t,r=this.parserListeners;r.element=function(t){"stream:error"===t.name&&(e.close().then(function(){return e.disconnect()}),e.emit("error",new b(t.children[0].name,t.getChildText("text","urn:ietf:params:xml:ns:xmpp-streams")||"",t))),e.emit("element",t),e.emit(e.isStanza(t)?"stanza":"nonza",t)},r.error=function(t){e.emit("error",t)},r.end=function(t){e._status("close",t)},n.once("error",r.error),n.on("element",r.element),n.on("end",r.end)}},{key:"_detachParser",value:function(){var t=this,e=this.parserListeners;Object.getOwnPropertyNames(e).forEach(function(n){t.parser.removeListener(n,e[n]),delete e[n]}),delete this.parser}},{key:"_jid",value:function(t){return this.jid=m(t),this.jid}},{key:"_status",value:function(t){this.status=t;for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];this.emit.apply(this,["status",t].concat(n)),this.emit.apply(this,[t].concat(n))}},{key:"start",value:function(t){var e=this;return"offline"!==this.status?Promise.reject(new Error("Connection is not offline")):(this.startOptions=t,"string"==typeof t&&(t={uri:t}),t.domain||(t.domain=s(t.uri)),Promise.all([this.promise("online"),this.connect(t.uri).then(function(){var n=t,r=n.domain,o=n.lang;return e.open({domain:r,lang:o})})]).then(function(t){return a(t,1)[0]}))}},{key:"connect",value:function(t){var e=this;return this._status("connecting"),this.connectOptions=t,new Promise(function(n,r){e._attachParser(new e.Parser),e._attachSocket(new e.Socket),e.socket.once("error",r),e.socket.connect(e.socketParameters(t),function(){e.socket.removeListener("error",r),n()})})}},{key:"disconnect",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;return this._status("disconnecting"),this.socket.end(),p(h(this.socket,"close"),t)}},{key:"open",value:function(t){var e=this;this._status("opening"),this.openOptions=t,"string"==typeof t&&(t={domain:t});var n=t,r=n.domain,o=n.lang,i=this.headerElement();return i.attrs.to=r,i.attrs["xml:lang"]=o,Promise.all([this.write(this.header(i)),h(this.parser,"start").then(function(t){return t.name===i.name&&t.attrs.xmlns===i.attrs.xmlns&&t.attrs.from===i.attrs.to&&t.attrs.id?(e.domain=r,e.lang=t.attrs["xml:lang"],e._status("open",t),t):e.promise("error")})]).then(function(t){return a(t,2)[1]})}},{key:"stop",value:function(){var t=this;return this.socket?this.close().then(function(e){return t.disconnect().then(function(){return t._status("offline"),e})}):Promise.resolve()}},{key:"close",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.timeout;return this._status("closing"),Promise.all([p(h(this.parser,"end"),t),this.write(this.footer(this.footerElement()))]).then(function(t){return a(t,1)[0]})}},{key:"restart",value:function(){var t=this;return this._detachParser(),this._attachParser(new this.Parser),this._status("restarting"),this.open(this.openOptions).then(function(){t._status("restart")})}},{key:"send",value:function(t){var e=this;return this.write(t).then(function(){e.emit("send",t)})}},{key:"sendReceive",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.timeout;return Promise.all([this.send(t),p(this.promise("element"),e)]).then(function(t){return a(t,2)[1]})}},{key:"write",value:function(t){var e=this;return new Promise(function(n,r){var o=t.toString("utf8");e.socket.write(o,function(t){if(t)return r(t);e.emit("output",o),n()})})}},{key:"isStanza",value:function(t){var e=t.name,n=t.attrs.xmlns;return!(n&&n!==this.NS||"iq"!==e&&"message"!==e&&"presence"!==e)}},{key:"isNonza",value:function(t){return!this.isStanza(t)}},{key:"plugin",value:function(t){if(!this.plugins[t.name]){this.plugins[t.name]=t.plugin(this);var e=this.plugins[t.name];e&&e.start?e.start():e&&e.register&&e.register()}return this.plugins[t.name]}},{key:"header",value:function(t){return t.toString()}},{key:"headerElement",value:function(){return new d.Element("",{version:"1.0",xmlns:this.NS})}},{key:"footer",value:function(t){return t.toString()}},{key:"footerElement",value:function(){}},{key:"socketParameters",value:function(t){var e=y.parse(t);return e.port=Number(e.port),e.host=e.hostname,e}}]),e}();g.prototype.NS="",g.prototype.Socket=null,g.prototype.Parser=null,e.exports=g,e.exports.getHostname=s,e.exports.XMPPError=v,e.exports.StreamError=b},{"@xmpp/events":18,"@xmpp/jid":24,"@xmpp/xml":43,url:1}],18:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=t("./lib/timeout"),a=t("./lib/delay"),u=t("./lib/TimeoutError"),c=t("./lib/promise"),l=t("./lib/EventEmitter");(n=e.exports=function(t){function e(){return r(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return i(e,l),e}()).EventEmitter=l,n.timeout=s,n.delay=a,n.TimeoutError=u,n.promise=c},{"./lib/EventEmitter":19,"./lib/TimeoutError":20,"./lib/delay":21,"./lib/promise":22,"./lib/timeout":23}],19:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=t("events"),s=t("./promise"),a=function(){function t(){r(this,t),this._emitter=new i,this._handlers=Object.create(null)}return o(t,[{key:"promise",value:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return s.apply(void 0,[this].concat(e))}},{key:"handle",value:function(t,e){this._handlers[t]=e}},{key:"delegate",value:function(t){var e=this._handlers[t];if(!e)throw new Error(t+" has no handler attached.");for(var n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];var i=e.apply(void 0,r);if(!(i instanceof Promise))throw new TypeError(t+" handler must return a promise.");return i}},{key:"isHandled",value:function(t){return Boolean(this._handlers[t])}}]),t}();["on","addListener","removeListener","once","emit","listenerCount"].forEach(function(t){a.prototype[t]=function(){var e;(e=this._emitter)[t].apply(e,arguments)}}),e.exports=a},{"./promise":22,events:2}],20:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.exports=function(t){function e(t){r(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.name="TimeoutError",n}return i(e,Error),e}()},{}],21:[function(t,e,n){"use strict";e.exports=function(t){return new Promise(function(e){setTimeout(e,t)})}},{}],22:[function(t,e,n){"use strict";e.exports=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"error";return new Promise(function(r,o){function i(t){o(t),a()}function s(t){r(t),a()}var a=function(){t.removeListener(e,s),t.removeListener(n,i)};t.once(e,s),n&&t.once(n,i)})}},{}],23:[function(t,e,n){"use strict";var r=t("./TimeoutError"),o=t("./delay");e.exports=function(t,e){return Promise.race([t,o(e).then(function(){throw new r})])}},{"./TimeoutError":20,"./delay":21}],24:[function(t,e,n){"use strict";function r(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return e[1]||e[2]?new(Function.prototype.bind.apply(o,[null].concat(e))):s.apply(void 0,e)}var o=t("./lib/JID"),i=t("./lib/escaping"),s=t("./lib/parse");(n=e.exports=r.bind()).jid=r,n.JID=o,n.equal=function(t,e){return t.equals(e)},n.detectEscape=i.detect,n.escapeLocal=i.escape,n.unescapeLocal=i.unescape,n.parse=s},{"./lib/JID":25,"./lib/escaping":26,"./lib/parse":27}],25:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=t("./escaping"),s=function(){function t(e,n,o){if(r(this,t),"string"!=typeof n||!n)throw new TypeError("Invalid domain.");this.setDomain(n),this.setLocal("string"==typeof e?e:""),this.setResource("string"==typeof o?o:"")}return o(t,[{key:Symbol.toPrimitive,value:function(t){return"number"===t?NaN:this.toString()}},{key:"toString",value:function(t){var e=this._domain;return this._local&&(e=this.getLocal(t)+"@"+e),this._resource&&(e=e+"/"+this._resource),e}},{key:"bare",value:function(){return this._resource?new t(this._local,this._domain,null):this}},{key:"equals",value:function(t){return this._local===t._local&&this._domain===t._domain&&this._resource===t._resource}},{key:"setLocal",value:function(t,e){return(e=e||i.detect(t))&&(t=i.escape(t)),this._local=t&&t.toLowerCase(),this}},{key:"getLocal",value:function(t){return(t=t||!1)?i.unescape(this._local):this._local}},{key:"setDomain",value:function(t){return this._domain=t.toLowerCase(),this}},{key:"getDomain",value:function(){return this._domain}},{key:"setResource",value:function(t){return this._resource=t,this}},{key:"getResource",value:function(){return this._resource}}]),t}();Object.defineProperty(s.prototype,"local",{get:s.prototype.getLocal,set:s.prototype.setLocal}),Object.defineProperty(s.prototype,"domain",{get:s.prototype.getDomain,set:s.prototype.setDomain}),Object.defineProperty(s.prototype,"resource",{get:s.prototype.getResource,set:s.prototype.setResource}),e.exports=s},{"./escaping":26}],26:[function(t,e,n){"use strict";e.exports.detect=function(t){return!!t&&-1!==t.replace(/\\20/g,"").replace(/\\22/g,"").replace(/\\26/g,"").replace(/\\27/g,"").replace(/\\2f/g,"").replace(/\\3a/g,"").replace(/\\3c/g,"").replace(/\\3e/g,"").replace(/\\40/g,"").replace(/\\5c/g,"").search(/\\| |"|&|'|\/|:|<|>|@/g)},e.exports.escape=function(t){return null===t?null:t.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/"/g,"\\22").replace(/&/g,"\\26").replace(/'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40").replace(/\3a/g,"c3a")},e.exports.unescape=function(t){return null===t?null:t.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")}},{}],27:[function(t,e,n){"use strict";var r=t("../lib/JID");e.exports=function(t){var e=void 0,n=void 0,o=t.indexOf("/");-1!==o&&(n=t.substr(o+1),t=t.substr(0,o));var i=t.indexOf("@");return-1!==i&&(e=t.substr(0,i),t=t.substr(i+1)),new r(e,t,n)}},{"../lib/JID":25}],28:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],s=function(t){function e(){return r(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return i(e,a),e}();return Object.assign(s.prototype,e),{name:t,plugin:function(t){var e=new s;e.attach(t);var r={};return n.forEach(function(e){r[e.name]=t.plugin(e)}),e.plugins=r,e},unplug:function(){}}}var a=t("./lib/Plugin"),u=t("@xmpp/jid"),c=t("@xmpp/xml");e.exports=s.bind(void 0),e.exports.plugin=s,e.exports.Plugin=a,e.exports.jid=u,e.exports.xml=c},{"./lib/Plugin":29,"@xmpp/jid":24,"@xmpp/xml":43}],29:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=t("@xmpp/events"),u=function(t){function e(){return r(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return i(e,a),s(e,[{key:"attach",value:function(t){this.entity=t}},{key:"detach",value:function(){delete this.entity}},{key:"start",value:function(){}},{key:"stop",value:function(){}}]),e}();e.exports=u},{"@xmpp/events":18}],30:[function(t,e,n){"use strict";function r(t){return a("bind",{xmlns:l},t&&a("resource",{},t))}function o(t){return t.getChild("bind",l)}var i=t("@xmpp/plugin"),s=i.plugin,a=i.xml,u=t("../stream-features"),c=t("../iq-caller"),l="urn:ietf:params:xml:ns:xmpp-bind";e.exports=s("bind",{start:function(){var t=this,e={name:"bind",priority:2500,match:o,run:function(){return t.handleFeature()}};this.plugins["stream-features"].add(e)},bind:function(t){var e=this;return this.entity._status("binding"),this.plugins["iq-caller"].set(r(t)).then(function(t){e.entity._jid(t.getChildText("jid")),e.entity._status("bound")})},handleFeature:function(){var t=this,e=this.entity;return e._status("bind"),e.isHandled("bind")?e.delegate("bind",function(e){return t.bind(e)}):this.bind()}},[u,c])},{"../iq-caller":31,"../stream-features":38,"@xmpp/plugin":28}],31:[function(t,e,n){"use strict";var r=t("@xmpp/plugin"),o=r.plugin,i=r.xml;e.exports=o("iq-caller",{start:function(){var t=this;this.handlers=new Map,this.handler=function(e){if(t.match(e)){var n=e.attrs.id,r=t.handlers.get(n);r&&("error"===e.attrs.type?r[1](e.getChild("error")):r[0](e.children[0]),t.handlers.delete(n))}},this.entity.on("element",this.handler)},stop:function(){this.entity.removeListener("element",this.handler)},id:function(){for(var t=void 0;!t;)t=Math.random().toString(36).substr(2,12);return t},match:function(t){return"iq"===t.name&&("error"===t.attrs.type||"result"===t.attrs.type)},get:function(t){var e=i("iq",{type:"get"});e.append(t);for(var n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return this.request.apply(this,[e].concat(r))},set:function(t){var e=i("iq",{type:"set"});e.append(t);for(var n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return this.request.apply(this,[e].concat(r))},request:function(t,e){var n=this;return new Promise(function(r,o){e&&"string"==typeof e&&!t.attrs.to&&(t.attrs.to=e),t.attrs.id||(t.attrs.id=n.id()),n.handlers.set(t.attrs.id,[r,o]),n.entity.send(t)})}})},{"@xmpp/plugin":28}],32:[function(t,e,n){"use strict";var r=t("@xmpp/plugin");e.exports=r("reconnect",{delay:1e3,reconnect:function(){var t=this,e=this.entity;this.emit("reconnecting"),this._timeout=setTimeout(function(){if("offline"!==e.status){var n=e.status;e.status="offline",e.start(e.startOptions).then(function(){t.emit("reconnected")}).catch(function(){return t.reconnect()}).catch(function(e){t.emit("error",e)}),e.status=n}},this.delay)},stopped:function(){var t=this.entity,e=this.listeners,n=this._timeout;t.removeListener("disconnect",e.disconnect),clearTimeout(n)},start:function(){var t=this,e={};e.disconnect=function(){t.reconnect()},e.online=function(){t.entity.on("disconnect",e.disconnect)},this.listeners=e,this.entity.once("online",e.online)},stop:function(){this.stopped(),this.entity.removeListener("online",this.listeners.online)}})},{"@xmpp/plugin":28}],33:[function(t,e,n){"use strict";var r=t("sasl-anonymous"),o=t("../sasl");e.exports.name="sasl-anonymous",e.exports.plugin=function(t){return t.plugin(o).use(r),{entity:t}}},{"../sasl":35,"sasl-anonymous":10}],34:[function(t,e,n){"use strict";var r=t("sasl-plain"),o=t("../sasl");e.exports.name="sasl-plain",e.exports.plugin=function(t){return t.plugin(o).use(r),{entity:t}}},{"../sasl":35,"sasl-plain":12}],35:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t){return t.getChild("mechanisms",d)}function a(t){return t.getChild("mechanisms",d).children.map(function(t){return t.text()})}var u=t("./lib/b64"),c=u.encode,l=u.decode,p=t("@xmpp/plugin"),f=t("@xmpp/xml"),h=t("../stream-features"),m=t("@xmpp/connection").XMPPError,y=t("saslmechanisms"),d="urn:ietf:params:xml:ns:xmpp-sasl",v=function(t){function e(){var t;r(this,e);for(var n=arguments.length,i=Array(n),s=0;s<n;s++)i[s]=arguments[s];var a=o(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(i)));return a.name="SASLError",a}return i(e,m),e}();e.exports=p("sasl",{start:function(){var t=this;this.SASL=new y,this.streamFeature={name:"sasl",priority:1e3,match:s,restart:!0,run:function(e,n){return t.gotFeatures(n)}},this.plugins["stream-features"].add(this.streamFeature)},stop:function(){delete this.SASL,this.plugins["stream-features"].remove(this.streamFeature),delete this.streamFeature,delete this.mech},use:function(){var t;(t=this.SASL).use.apply(t,arguments)},gotFeatures:function(t){var e=this,n=a(t),r=this.getUsableMechanisms(n);return Promise.resolve(this.getMechanism(r)).then(function(n){return e.mech=n,e.handleMechanism(n,t)})},handleMechanism:function(t,e){var n=this;return this.entity._status("authenticate"),"ANONYMOUS"===t?this.authenticate(t,{},e):this.entity.delegate("authenticate",function(r,o){return n.authenticate(t,{username:r,password:o},e)},t)},getAvailableMechanisms:function(){return this.SASL._mechs.map(function(t){return t.name})},getUsableMechanisms:function(t){var e=this.getAvailableMechanisms();return t.filter(function(t){return e.indexOf(t)>-1})},getMechanism:function(t){return t[0]},findMechanism:function(t){return this.SASL.create([t])},authenticate:function(t,e){var n=this,r=this.findMechanism(t);if(!r)return Promise.reject(new Error("no compatible mechanism"));var o=this.entity.options.domain,i=Object.assign({username:null,password:null,server:o,host:o,realm:o,serviceType:"xmpp",serviceName:o},e);return this.entity._status("authenticating"),new Promise(function(t,e){n.entity.on("nonza",function o(s){if(s.attrs.xmlns===d)if("challenge"!==s.name)"failure"===s.name?e(new v(s.children[0].name,s.getChildText("text")||"",s)):"success"===s.name&&(t(),n.entity._status("authenticated")),n.entity.removeListener("nonza",o);else{r.challenge(l(s.text()));var a=r.response(i);n.entity.send(f("response",{xmlns:d,mechanism:r.name},"string"==typeof a?c(a):""))}}),r.clientFirst&&n.entity.send(f("auth",{xmlns:d,mechanism:r.name},c(r.response(i))))})}},[h])},{"../stream-features":38,"./lib/b64":36,"@xmpp/connection":17,"@xmpp/plugin":28,"@xmpp/xml":43,saslmechanisms:14}],36:[function(t,e,n){(function(t,n){"use strict";e.exports.encode=function(e){return t.Buffer?n.from(e,"utf8").toString("base64"):t.btoa(e)},e.exports.decode=function(e){return t.Buffer?n.from(e,"base64").toString("utf8"):t.atob(e)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},t("buffer").Buffer)},{buffer:1}],37:[function(t,e,n){"use strict";function r(t){var e=t.getChild("session",c);return Boolean(e)&&!e.getChild("optional")}var o=t("@xmpp/plugin"),i=o.plugin,s=o.xml,a=t("../stream-features"),u=t("../iq-caller"),c="urn:ietf:params:xml:ns:xmpp-session";e.exports=i("session-establishment",{start:function(){var t=this,e={name:"session-establishment",priority:2e3,match:r,run:function(){return t.establishSession()}};this.plugins["stream-features"].add(e)},establishSession:function(){return this.entity.plugins["iq-caller"].set(s("session","urn:ietf:params:xml:ns:xmpp-session"))}},[a,u]),e.exports.match=r},{"../iq-caller":31,"../stream-features":38,"@xmpp/plugin":28}],38:[function(t,e,n){"use strict";var r=t("@xmpp/plugin");e.exports=r("stream-features",{start:function(){var t=this;this.features=[];var e=this.entity;this.handler=function(n){function r(t){var i=o[t];return i.run(e,n).then(function(){if(i.restart)return e.restart();t===o.length-1?e.jid&&e._status("online",e.jid):r(t+1)}).catch(function(t){return e.emit("error",t)})}if("stream:features"===n.name){var o=t.selectFeatures(n);if(0!==o.length)return r(0)}},e.on("nonza",this.handler)},stop:function(){delete this.features,this.entity.off("nonza",this.handler),delete this.handler},selectFeatures:function(t){var e=this;return this.features.filter(function(n){return n.match(t,e.entity)&&"number"==typeof n.priority}).sort(function(t,e){return t.priority<e.priority})},add:function(t){var e=t.name,n=t.priority,r=t.run,o=t.match,i=t.restart;this.features.push({name:e,priority:n,run:r,match:o,restart:i})}})},{"@xmpp/plugin":28}],39:[function(t,e,n){"use strict";var r=t("./lib/Connection");e.exports.name="websocket",e.exports.plugin=function(t){return t.transports.push(r),{entity:t}}},{"./lib/Connection":40}],40:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function t(e,n,r){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,r)}if("value"in o)return o.value;var s=o.get;if(void 0!==s)return s.call(r)},u=t("./Socket"),c=t("@xmpp/connection"),l=t("@xmpp/xml"),p=t("./FramedParser"),f="urn:ietf:params:xml:ns:xmpp-framing",h=function(t){function e(){return r(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return i(e,c),s(e,[{key:"footerElement",value:function(){return new l.Element("close",{xmlns:f})}},{key:"headerElement",value:function(){var t=a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"headerElement",this).call(this);return t.name="open",t.attrs.xmlns=f,t}},{key:"socketParameters",value:function(t){return t.match(/^wss?:\/\//)?t:void 0}}]),e}();h.prototype.Socket=u,h.prototype.NS="jabber:client",h.prototype.Parser=p,e.exports=h},{"./FramedParser":41,"./Socket":42,"@xmpp/connection":17,"@xmpp/xml":43}],41:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=t("@xmpp/xml").Parser;e.exports=function(t){function e(){return r(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return i(e,a),s(e,[{key:"onStartElement",value:function(){}},{key:"onEndElement",value:function(t,e){1===e&&(t.is("open","urn:ietf:params:xml:ns:xmpp-framing")?this.emit("start",t):t.is("close","urn:ietf:params:xml:ns:xmpp-framing")?this.emit("end",t):this.emit("element",t))}}]),e}()},{"@xmpp/xml":43}],42:[function(t,e,n){(function(n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=t("ws"),u=n.WebSocket||a,c=t("events"),l=function(t){function e(){r(this,e);var t=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.listeners=Object.create(null),t}return i(e,c),s(e,[{key:"connect",value:function(t,e){this.url=t,this._attachSocket(new u(t,["xmpp"]),e)}},{key:"_attachSocket",value:function(t,e){var n=this,r=this.socket=t,o=this.listeners;o.open=function(){n.emit("connect"),e&&e()},o.message=function(t){var e=t.data;return n.emit("data",e)},o.error=function(t){n.emit("error",t instanceof Error?t:new Error("connection error "+n.url))},o.close=function(t){var e=t.code,r=t.reason;n._detachSocket(),n.emit("close",{code:e,reason:r})},r.addEventListener("open",o.open),r.addEventListener("message",o.message),r.addEventListener("error",o.error),r.addEventListener("close",o.close)}},{key:"_detachSocket",value:function(){delete this.url;var t=this.socket,e=this.listeners;Object.getOwnPropertyNames(e).forEach(function(n){t.removeEventListener(n,e[n]),delete e[n]}),delete this.socket}},{key:"end",value:function(){this.socket.close()}},{key:"write",value:function(t,e){u===a?this.socket.send(t,e):(this.socket.send(t),e())}}]),e}();e.exports=l}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{events:2,ws:1}],43:[function(t,e,n){"use strict";var r=t("./lib/x"),o=t("./lib/Element"),i=t("./lib/Parser"),s=t("ltx/lib/escape"),a=s.escapeXML,u=s.unescapeXML,c=s.escapeXMLText,l=s.unescapeXMLText;n=e.exports=function(){return r.apply(void 0,arguments)},Object.assign(n,{x:r,Element:o,Parser:i,escapeXML:a,unescapeXML:u,escapeXMLText:c,unescapeXMLText:l})},{"./lib/Element":44,"./lib/Parser":45,"./lib/x":46,"ltx/lib/escape":7}],44:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=t("ltx/lib/Element"),c=function(t){function e(){return r(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return i(e,u),a(e,[{key:"append",value:function(t){var e=this;(t=Array.isArray(t)?t:[t]).forEach(function(t){e.children.push(t),"object"===(void 0===t?"undefined":s(t))&&(t.parent=e)})}},{key:"prepend",value:function(t){var e=this;(t=Array.isArray(t)?t:[t]).forEach(function(t){e.children.unshift(t),"object"===(void 0===t?"undefined":s(t))&&(t.parent=e)})}}]),e}();e.exports=c},{"ltx/lib/Element":4}],45:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=t("ltx/lib/parsers/ltx"),u=t("./Element"),c=t("events"),l=function(t){function e(){var t;r(this,e);for(var n=arguments.length,i=Array(n),s=0;s<n;s++)i[s]=arguments[s];var a=o(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(i)));return a.name="XMLError",a}return i(e,Error),e}(),p=function(t){function e(){r(this,e);var t=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),n=new a,i=[],s=void 0;return n.on("startElement",function(e,n){var r=new u(e,n);s&&s.append(r),t.onStartElement(r,s),t.emit("startElement",r),i.push(s),s=r}),n.on("endElement",function(e){e===s.name?(t.onEndElement(s,i.length),t.emit("endElement",s),s=i.pop()):t.emit("error",new l(s.name+" must be closed."))}),n.on("text",function(e){t.onText(e,s)}),t.parser=n,t}return i(e,c),s(e,[{key:"onStartElement",value:function(t,e){e||this.emit("start",t)}},{key:"onEndElement",value:function(t,e){2===e?this.emit("element",t):1===e&&this.emit("end",t)}},{key:"onText",value:function(t,e){e?e.t(t):this.emit("error",new l(t+" must be a child."))}},{key:"write",value:function(t){this.parser.write(t)}},{key:"end",value:function(t){t&&this.parser.write(t)}}]),e}();p.XMLError=l,e.exports=p},{"./Element":44,events:2,"ltx/lib/parsers/ltx":8}],46:[function(t,e,n){"use strict";function r(t,e){e instanceof o?t.append(e):Array.isArray(e)?e.forEach(function(e){return r(t,e)}):null!==e&&void 0!==e&&t.append(String(e))}var o=t("./Element");e.exports=function(t,e){for(var n=new o(t,e),i=arguments.length,s=Array(i>2?i-2:0),a=2;a<i;a++)s[a-2]=arguments[a];for(var u=0;u<s.length;u++)r(n,s[u]);return n}},{"./Element":44}],47:[function(t,e,n){"use strict";var r=t("./lib/Client"),o=t("@xmpp/client-core"),i=o.xml,s=o.jid;e.exports.Client=r,e.exports.xml=i,e.exports.jid=s},{"./lib/Client":48,"@xmpp/client-core":15}],48:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=t("@xmpp/client-core").Client,a=t("./plugins"),u=function(t){function e(){var t;r(this,e);for(var n=arguments.length,i=Array(n),s=0;s<n;s++)i[s]=arguments[s];var u=o(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(i)));return Object.keys(a).forEach(function(t){var e=a[t];e.plugin&&u.plugin(e)}),u}return i(e,s),e}();e.exports=u},{"./plugins":49,"@xmpp/client-core":15}],49:[function(t,e,n){"use strict";n["stream-features"]=t("@xmpp/plugins/stream-features"),n.bind=t("@xmpp/plugins/bind"),n.sasl=t("@xmpp/plugins/sasl"),n["sasl-plain"]=t("@xmpp/plugins/sasl-plain"),n["sasl-anonymous"]=t("@xmpp/plugins/sasl-anonymous"),n.websocket=t("@xmpp/plugins/websocket"),n.tcp=t("@xmpp/plugins/tcp"),n.tls=t("@xmpp/plugins/tls"),n.reconnect=t("@xmpp/plugins/reconnect"),n.starttls=t("@xmpp/plugins/starttls"),n["session-establishment"]=t("@xmpp/plugins/session-establishment")},{"@xmpp/plugins/bind":30,"@xmpp/plugins/reconnect":32,"@xmpp/plugins/sasl":35,"@xmpp/plugins/sasl-anonymous":33,"@xmpp/plugins/sasl-plain":34,"@xmpp/plugins/session-establishment":37,"@xmpp/plugins/starttls":1,"@xmpp/plugins/stream-features":38,"@xmpp/plugins/tcp":1,"@xmpp/plugins/tls":1,"@xmpp/plugins/websocket":39}]},{},[47])(47)});
//# sourceMappingURL=xmpp.min.js.map