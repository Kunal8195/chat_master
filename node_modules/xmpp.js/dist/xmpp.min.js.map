{"version":3,"sources":["../../node_modules/browser-pack/_prelude.js","../../node_modules/browser-resolve/empty.js","../../node_modules/events/events.js","../../node_modules/inherits/inherits_browser.js","../../node_modules/ltx/lib/Element.js","../../node_modules/ltx/lib/clone.js","../../node_modules/ltx/lib/equal.js","../../node_modules/ltx/lib/escape.js","../../node_modules/ltx/lib/parsers/ltx.js","../../node_modules/sasl-anonymous/lib/mechanism.js","../../node_modules/sasl-anonymous/main.js","../../node_modules/sasl-plain/lib/mechanism.js","../../node_modules/saslmechanisms/lib/factory.js","../../node_modules/saslmechanisms/main.js","../client-core/index.js","../client-core/lib/Client.js","../connection/index.js","../events/index.js","../events/lib/EventEmitter.js","../events/lib/TimeoutError.js","../events/lib/delay.js","../events/lib/promise.js","../events/lib/timeout.js","../jid/index.js","../jid/lib/JID.js","../jid/lib/escaping.js","../jid/lib/parse.js","../plugin/index.js","../plugin/lib/Plugin.js","../plugins/bind/index.js","../plugins/iq-caller/index.js","../plugins/reconnect/index.js","../plugins/sasl-anonymous/index.js","../plugins/sasl-plain/index.js","../plugins/sasl/index.js","../plugins/sasl/lib/b64.js","../plugins/session-establishment/index.js","../plugins/stream-features/index.js","../plugins/websocket/index.js","../plugins/websocket/lib/Connection.js","../plugins/websocket/lib/FramedParser.js","../plugins/websocket/lib/Socket.js","../xml/index.js","../xml/lib/Element.js","../xml/lib/Parser.js","../xml/lib/x.js","index.js","lib/Client.js","lib/plugins.js"],"names":["f","exports","module","define","amd","window","global","self","this","xmpp","e","t","n","r","s","o","u","a","require","i","Error","code","l","call","length","1","EventEmitter","_events","_maxListeners","undefined","isFunction","arg","isNumber","isObject","_typeof","isUndefined","prototype","defaultMaxListeners","setMaxListeners","isNaN","TypeError","emit","type","er","handler","len","args","listeners","error","arguments","err","context","Array","slice","apply","addListener","listener","m","newListener","push","warned","console","trace","on","once","g","removeListener","fired","list","position","splice","removeAllListeners","key","listenerCount","evlistener","emitter","Object","create","ctor","superCtor","super_","constructor","value","enumerable","writable","configurable","TempCtor","Element","name","attrs","parent","children","setAttrs","escape","escapeXML","escapeXMLText","equality","equal","nameEqual","attrsEqual","childrenEqual","clone","is","xmlns","getName","getNS","indexOf","substr","prefix","findNS","attr","getXmlns","namespaces","match","hasOwnProperty","keys","forEach","getAttr","join","getChild","getChildren","result","child","getChildByAttr","val","recursive","getChildrenByAttr","concat","getChildrenByFilter","filter","getText","text","getChildText","getChildElements","root","tree","up","c","cnode","remove","el","toString","write","toJSON","map","_addChildren","writer","k","v","nameEquals","attrsEquals","childrenEquals","equals","b","escapeXMLReplace","escapeXMLTable","unescapeXMLReplace","unescapeXMLTable","&","<",">","\"","'","&amp;","&#38;","&lt;","&#60;","&gt;","&#62;","&quot;","&#34;","&apos;","&#39;","replace","unescapeXML","unescapeXMLText","inherits","SaxLtx","remainder","tagName","endTag","selfClosing","attrQuote","attrName","state","recordStart","_handleTagOpening","data","endRecording","recorded","pos","charCodeAt","cData","prevFirst","prevSecond","end","factory","Mechanism","clientFirst","response","cred","challenge","chal","str","authzid","username","password","Factory","_mechs","use","mech","mechs","j","jlen","entry","Client","xml","jid","Connection","options","_classCallCheck","_this","_possibleConstructorReturn","__proto__","getPrototypeOf","transports","element","_get2","_len","_key","_get","uri","Transport","find","socketParameters","Socket","Parser","_Transport$prototype","_Transport$prototype2","header","_Transport$prototype3","headerElement","_Transport$prototype4","footer","_Transport$prototype5","footerElement","NS","getHostname","url","parse","parsed","hostname","pathname","document","createElement","href","timeout","promise","XMPPError","condition","StreamError","_ref","_this2","_this3","domain","lang","plugins","startOptions","openOptions","connectOptions","socketListeners","parserListeners","status","_detachSocket","_detachParser","socket","_this4","sock","parser","close","_len2","_key2","_reset","_status","connect","_this5","getOwnPropertyNames","p","_this6","then","disconnect","isStanza","_this7","id","_len3","_key3","_this8","Promise","reject","all","_options","open","_ref2","_slicedToArray","_this9","resolve","_attachParser","_attachSocket","ms","_this10","_options2","to","from","_ref4","_this11","_ref6","_this12","_this13","send","_ref8","_this14","_plugin","plugin","start","register","version","port","Number","host","delay","TimeoutError","_EventEmitter","_EventEmitter2","_inherits","promiseEvent","_emitter","_handlers","event","Boolean","_Error","message","setTimeout","EE","rejectEvent","onError","reason","cleanup","onEvent","race","Function","bind","JID","escaping","detectEscape","detect","escapeLocal","unescapeLocal","unescape","local","resource","setDomain","setLocal","setResource","Symbol","toPrimitive","hint","NaN","_domain","_local","getLocal","_resource","other","toLowerCase","defineProperty","get","set","getDomain","getResource","search","resourceStart","atStart","props","dependencies","Plugin","_Plugin2","_Plugin","assign","entity","attach","dep","unplug","makeBindElement","features","streamfeatures","iqCaller","streamFeature","priority","run","handleFeature","add","_jid","isHandled","delegate","handlers","Map","stanza","delete","stop","Math","random","iq","append","request","reconnect","_timeout","catch","stopped","clearTimeout","online","sasl","getMechanismNames","encode","decode","streamFeatures","SASLFactory","SASLError","SASL","restart","gotFeatures","_SASL","offered","usable","getUsableMechanisms","getMechanism","handleMechanism","authenticate","getAvailableMechanisms","supported","findMechanism","mechname","credentials","creds","server","realm","serviceType","serviceName","resp","mechanism","string","Buffer","btoa","atob","feature","establishSession","iterate","selectFeatures","off","sort","ConnectionWebSocket","FramedParser","NS_FRAMING","_Parser","_createClass","WS","WebSocket","fn","addEventListener","removeEventListener","x","_Element","nodes","isArray","node","unshift","LtxParser","XMLError","stack","cursor","onStartElement","onEndElement","pop","onText","String","ClientCore","websocket","tcp","tls","starttls"],"mappings":"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","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","\"use strict\";\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJlbXB0eS5qcyIsInNvdXJjZXNDb250ZW50IjpbXX0=","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      } else {\n        // At least give some kind of context to the user\n        var err = new Error('Uncaught, unspecified \"error\" event. (' + er + ')');\n        err.context = er;\n        throw err;\n      }\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        args = Array.prototype.slice.call(arguments, 1);\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    args = Array.prototype.slice.call(arguments, 1);\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else if (listeners) {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.prototype.listenerCount = function(type) {\n  if (this._events) {\n    var evlistener = this._events[type];\n\n    if (isFunction(evlistener))\n      return 1;\n    else if (evlistener)\n      return evlistener.length;\n  }\n  return 0;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  return emitter.listenerCount(type);\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    var TempCtor = function () {}\n    TempCtor.prototype = superCtor.prototype\n    ctor.prototype = new TempCtor()\n    ctor.prototype.constructor = ctor\n  }\n}\n","'use strict'\n\nvar escape = require('./escape')\nvar escapeXML = escape.escapeXML\nvar escapeXMLText = escape.escapeXMLText\n\nvar equality = require('./equal')\nvar equal = equality.equal\nvar nameEqual = equality.name\nvar attrsEqual = equality.attrs\nvar childrenEqual = equality.children\n\nvar clone = require('./clone')\n\n/**\n * Element\n *\n * Attributes are in the element.attrs object. Children is a list of\n * either other Elements or Strings for text content.\n **/\nfunction Element (name, attrs) {\n  this.name = name\n  this.parent = null\n  this.children = []\n  this.attrs = {}\n  this.setAttrs(attrs)\n}\n\n/* Accessors */\n\n/**\n * if (element.is('message', 'jabber:client')) ...\n **/\nElement.prototype.is = function (name, xmlns) {\n  return (this.getName() === name) &&\n  (!xmlns || (this.getNS() === xmlns))\n}\n\n/* without prefix */\nElement.prototype.getName = function () {\n  if (this.name.indexOf(':') >= 0) {\n    return this.name.substr(this.name.indexOf(':') + 1)\n  } else {\n    return this.name\n  }\n}\n\n/**\n * retrieves the namespace of the current element, upwards recursively\n **/\nElement.prototype.getNS = function () {\n  if (this.name.indexOf(':') >= 0) {\n    var prefix = this.name.substr(0, this.name.indexOf(':'))\n    return this.findNS(prefix)\n  }\n  return this.findNS()\n}\n\n/**\n * find the namespace to the given prefix, upwards recursively\n **/\nElement.prototype.findNS = function (prefix) {\n  if (!prefix) {\n    /* default namespace */\n    if (this.attrs.xmlns) {\n      return this.attrs.xmlns\n    } else if (this.parent) {\n      return this.parent.findNS()\n    }\n  } else {\n    /* prefixed namespace */\n    var attr = 'xmlns:' + prefix\n    if (this.attrs[attr]) {\n      return this.attrs[attr]\n    } else if (this.parent) {\n      return this.parent.findNS(prefix)\n    }\n  }\n}\n\n/**\n * Recursiverly gets all xmlns defined, in the form of {url:prefix}\n **/\nElement.prototype.getXmlns = function () {\n  var namespaces = {}\n\n  if (this.parent) {\n    namespaces = this.parent.getXmlns()\n  }\n\n  for (var attr in this.attrs) {\n    var m = attr.match('xmlns:?(.*)')\n    if (this.attrs.hasOwnProperty(attr) && m) {\n      namespaces[this.attrs[attr]] = m[1]\n    }\n  }\n  return namespaces\n}\n\nElement.prototype.setAttrs = function (attrs) {\n  if (typeof attrs === 'string') {\n    this.attrs.xmlns = attrs\n  } else if (attrs) {\n    Object.keys(attrs).forEach(function (key) {\n      this.attrs[key] = attrs[key]\n    }, this)\n  }\n}\n\n/**\n * xmlns can be null, returns the matching attribute.\n **/\nElement.prototype.getAttr = function (name, xmlns) {\n  if (!xmlns) {\n    return this.attrs[name]\n  }\n\n  var namespaces = this.getXmlns()\n\n  if (!namespaces[xmlns]) {\n    return null\n  }\n\n  return this.attrs[[namespaces[xmlns], name].join(':')]\n}\n\n/**\n * xmlns can be null\n **/\nElement.prototype.getChild = function (name, xmlns) {\n  return this.getChildren(name, xmlns)[0]\n}\n\n/**\n * xmlns can be null\n **/\nElement.prototype.getChildren = function (name, xmlns) {\n  var result = []\n  for (var i = 0; i < this.children.length; i++) {\n    var child = this.children[i]\n    if (child.getName &&\n      (child.getName() === name) &&\n      (!xmlns || (child.getNS() === xmlns))) {\n      result.push(child)\n    }\n  }\n  return result\n}\n\n/**\n * xmlns and recursive can be null\n **/\nElement.prototype.getChildByAttr = function (attr, val, xmlns, recursive) {\n  return this.getChildrenByAttr(attr, val, xmlns, recursive)[0]\n}\n\n/**\n * xmlns and recursive can be null\n **/\nElement.prototype.getChildrenByAttr = function (attr, val, xmlns, recursive) {\n  var result = []\n  for (var i = 0; i < this.children.length; i++) {\n    var child = this.children[i]\n    if (child.attrs &&\n      (child.attrs[attr] === val) &&\n      (!xmlns || (child.getNS() === xmlns))) {\n      result.push(child)\n    }\n    if (recursive && child.getChildrenByAttr) {\n      result.push(child.getChildrenByAttr(attr, val, xmlns, true))\n    }\n  }\n  if (recursive) {\n    result = [].concat.apply([], result)\n  }\n  return result\n}\n\nElement.prototype.getChildrenByFilter = function (filter, recursive) {\n  var result = []\n  for (var i = 0; i < this.children.length; i++) {\n    var child = this.children[i]\n    if (filter(child)) {\n      result.push(child)\n    }\n    if (recursive && child.getChildrenByFilter) {\n      result.push(child.getChildrenByFilter(filter, true))\n    }\n  }\n  if (recursive) {\n    result = [].concat.apply([], result)\n  }\n  return result\n}\n\nElement.prototype.getText = function () {\n  var text = ''\n  for (var i = 0; i < this.children.length; i++) {\n    var child = this.children[i]\n    if ((typeof child === 'string') || (typeof child === 'number')) {\n      text += child\n    }\n  }\n  return text\n}\n\nElement.prototype.getChildText = function (name, xmlns) {\n  var child = this.getChild(name, xmlns)\n  return child ? child.getText() : null\n}\n\n/**\n * Return all direct descendents that are Elements.\n * This differs from `getChildren` in that it will exclude text nodes,\n * processing instructions, etc.\n */\nElement.prototype.getChildElements = function () {\n  return this.getChildrenByFilter(function (child) {\n    return child instanceof Element\n  })\n}\n\n/* Builder */\n\n/** returns uppermost parent */\nElement.prototype.root = function () {\n  if (this.parent) {\n    return this.parent.root()\n  }\n  return this\n}\nElement.prototype.tree = Element.prototype.root\n\n/** just parent or itself */\nElement.prototype.up = function () {\n  if (this.parent) {\n    return this.parent\n  }\n  return this\n}\n\n/** create child node and return it */\nElement.prototype.c = function (name, attrs) {\n  return this.cnode(new Element(name, attrs))\n}\n\nElement.prototype.cnode = function (child) {\n  this.children.push(child)\n  if (typeof child === 'object') {\n    child.parent = this\n  }\n  return child\n}\n\n/** add text node and return element */\nElement.prototype.t = function (text) {\n  this.children.push(text)\n  return this\n}\n\n/* Manipulation */\n\n/**\n * Either:\n *   el.remove(childEl)\n *   el.remove('author', 'urn:...')\n */\nElement.prototype.remove = function (el, xmlns) {\n  var filter\n  if (typeof el === 'string') {\n    /* 1st parameter is tag name */\n    filter = function (child) {\n      return !(child.is &&\n      child.is(el, xmlns))\n    }\n  } else {\n    /* 1st parameter is element */\n    filter = function (child) {\n      return child !== el\n    }\n  }\n\n  this.children = this.children.filter(filter)\n\n  return this\n}\n\nElement.prototype.clone = function () {\n  return clone(this)\n}\n\nElement.prototype.text = function (val) {\n  if (val && this.children.length === 1) {\n    this.children[0] = val\n    return this\n  }\n  return this.getText()\n}\n\nElement.prototype.attr = function (attr, val) {\n  if (typeof val !== 'undefined' || val === null) {\n    if (!this.attrs) {\n      this.attrs = {}\n    }\n    this.attrs[attr] = val\n    return this\n  }\n  return this.attrs[attr]\n}\n\n/* Serialization */\n\nElement.prototype.toString = function () {\n  var s = ''\n  this.write(function (c) {\n    s += c\n  })\n  return s\n}\n\nElement.prototype.toJSON = function () {\n  return {\n    name: this.name,\n    attrs: this.attrs,\n    children: this.children.map(function (child) {\n      return child && child.toJSON ? child.toJSON() : child\n    })\n  }\n}\n\nElement.prototype._addChildren = function (writer) {\n  writer('>')\n  for (var i = 0; i < this.children.length; i++) {\n    var child = this.children[i]\n    /* Skip null/undefined */\n    if (child || (child === 0)) {\n      if (child.write) {\n        child.write(writer)\n      } else if (typeof child === 'string') {\n        writer(escapeXMLText(child))\n      } else if (child.toString) {\n        writer(escapeXMLText(child.toString(10)))\n      }\n    }\n  }\n  writer('</')\n  writer(this.name)\n  writer('>')\n}\n\nElement.prototype.write = function (writer) {\n  writer('<')\n  writer(this.name)\n  for (var k in this.attrs) {\n    var v = this.attrs[k]\n    if (v != null) { // === null || undefined\n      writer(' ')\n      writer(k)\n      writer('=\"')\n      if (typeof v !== 'string') {\n        v = v.toString()\n      }\n      writer(escapeXML(v))\n      writer('\"')\n    }\n  }\n  if (this.children.length === 0) {\n    writer('/>')\n  } else {\n    this._addChildren(writer)\n  }\n}\n\nElement.prototype.nameEquals = function (el) {\n  return nameEqual(this, el)\n}\n\nElement.prototype.attrsEquals = function (el) {\n  return attrsEqual(this, el)\n}\n\nElement.prototype.childrenEquals = function (el) {\n  return childrenEqual(this, el)\n}\n\nElement.prototype.equals = function (el) {\n  return equal(this, el)\n}\n\nmodule.exports = Element\n","'use strict'\n\nmodule.exports = function clone (el) {\n  var clone = new el.constructor(el.name, el.attrs)\n  for (var i = 0; i < el.children.length; i++) {\n    var child = el.children[i]\n    clone.cnode(child.clone ? child.clone() : child)\n  }\n  return clone\n}\n","'use strict'\n\nfunction nameEqual (a, b) {\n  return a.name === b.name\n}\n\nfunction attrsEqual (a, b) {\n  var attrs = a.attrs\n  var keys = Object.keys(attrs)\n  var length = keys.length\n  if (length !== Object.keys(b.attrs).length) return false\n  for (var i = 0, l = length; i < l; i++) {\n    var key = keys[i]\n    var value = attrs[key]\n    if (value == null || b.attrs[key] == null) { // === null || undefined\n      if (value !== b.attrs[key]) return false\n    } else if (value.toString() !== b.attrs[key].toString()) {\n      return false\n    }\n  }\n  return true\n}\n\nfunction childrenEqual (a, b) {\n  var children = a.children\n  var length = children.length\n  if (length !== b.children.length) return false\n  for (var i = 0, l = length; i < l; i++) {\n    var child = children[i]\n    if (typeof child === 'string') {\n      if (child !== b.children[i]) return false\n    } else {\n      if (!child.equals(b.children[i])) return false\n    }\n  }\n  return true\n}\n\nfunction equal (a, b) {\n  if (!nameEqual(a, b)) return false\n  if (!attrsEqual(a, b)) return false\n  if (!childrenEqual(a, b)) return false\n  return true\n}\n\nmodule.exports.name = nameEqual\nmodule.exports.attrs = attrsEqual\nmodule.exports.children = childrenEqual\nmodule.exports.equal = equal\n","'use strict'\n\nvar escapeXMLTable = {\n  '&': '&amp;',\n  '<': '&lt;',\n  '>': '&gt;',\n  '\"': '&quot;',\n  '\\'': '&apos;'\n}\n\nfunction escapeXMLReplace (match) {\n  return escapeXMLTable[match]\n}\n\nvar unescapeXMLTable = {\n  '&amp;': '&',\n  '&#38;': '&',\n  '&lt;': '<',\n  '&#60;': '<',\n  '&gt;': '>',\n  '&#62;': '>',\n  '&quot;': '\"',\n  '&#34;': '\"',\n  '&apos;': \"'\",\n  '&#39;': \"'\"\n}\n\nfunction unescapeXMLReplace (match) {\n  return unescapeXMLTable[match]\n}\n\nexports.escapeXML = function escapeXML (s) {\n  return s.replace(/&|<|>|\"|'/g, escapeXMLReplace)\n}\n\nexports.unescapeXML = function unescapeXML (s) {\n  return s.replace(/&(amp|#38|lt|#60|gt|#62|quot|#34|apos|#39);/g, unescapeXMLReplace)\n}\n\nexports.escapeXMLText = function escapeXMLText (s) {\n  return s.replace(/&|<|>/g, escapeXMLReplace)\n}\n\nexports.unescapeXMLText = function unescapeXMLText (s) {\n  return s.replace(/&(amp|#38|lt|#60|gt|#62);/g, unescapeXMLReplace)\n}\n","'use strict'\n\nvar inherits = require('inherits')\nvar EventEmitter = require('events').EventEmitter\nvar unescapeXML = require('../escape').unescapeXML\n\nvar STATE_TEXT = 0\nvar STATE_IGNORE_COMMENT = 1\nvar STATE_IGNORE_INSTRUCTION = 2\nvar STATE_TAG_NAME = 3\nvar STATE_TAG = 4\nvar STATE_ATTR_NAME = 5\nvar STATE_ATTR_EQ = 6\nvar STATE_ATTR_QUOT = 7\nvar STATE_ATTR_VALUE = 8\nvar STATE_CDATA = 9\n\nvar SaxLtx = module.exports = function SaxLtx () {\n  EventEmitter.call(this)\n\n  var state = STATE_TEXT\n  var remainder\n  var tagName\n  var attrs\n  var endTag\n  var selfClosing\n  var attrQuote\n  var recordStart = 0\n  var attrName\n\n  this._handleTagOpening = function (endTag, tagName, attrs) {\n    if (!endTag) {\n      this.emit('startElement', tagName, attrs)\n      if (selfClosing) {\n        this.emit('endElement', tagName)\n      }\n    } else {\n      this.emit('endElement', tagName)\n    }\n  }\n\n  this.write = function (data) {\n    if (typeof data !== 'string') {\n      data = data.toString()\n    }\n    var pos = 0\n\n    /* Anything from previous write()? */\n    if (remainder) {\n      data = remainder + data\n      pos += remainder.length\n      remainder = null\n    }\n\n    function endRecording () {\n      if (typeof recordStart === 'number') {\n        var recorded = data.slice(recordStart, pos)\n        recordStart = undefined\n        return recorded\n      }\n    }\n\n    for (; pos < data.length; pos++) {\n      var c = data.charCodeAt(pos)\n      switch (state) {\n        case STATE_TEXT:\n          if (c === 60 /* < */) {\n            var text = endRecording()\n            if (text) {\n              this.emit('text', unescapeXML(text))\n            }\n            state = STATE_TAG_NAME\n            recordStart = pos + 1\n            attrs = {}\n          }\n          break\n        case STATE_CDATA:\n          if (c === 93 /* ] */ && data.substr(pos + 1, 2) === ']>') {\n            var cData = endRecording()\n            if (cData) {\n              this.emit('text', cData)\n            }\n            state = STATE_IGNORE_COMMENT\n          }\n          break\n        case STATE_TAG_NAME:\n          if (c === 47 /* / */ && recordStart === pos) {\n            recordStart = pos + 1\n            endTag = true\n          } else if (c === 33 /* ! */) {\n            if (data.substr(pos + 1, 7) === '[CDATA[') {\n              recordStart = pos + 8\n              state = STATE_CDATA\n            } else {\n              recordStart = undefined\n              state = STATE_IGNORE_COMMENT\n            }\n          } else if (c === 63 /* ? */) {\n            recordStart = undefined\n            state = STATE_IGNORE_INSTRUCTION\n          } else if (c <= 32 || c === 47 /* / */ || c === 62 /* > */) {\n            tagName = endRecording()\n            pos--\n            state = STATE_TAG\n          }\n          break\n        case STATE_IGNORE_COMMENT:\n          if (c === 62 /* > */) {\n            var prevFirst = data.charCodeAt(pos - 1)\n            var prevSecond = data.charCodeAt(pos - 2)\n            if ((prevFirst === 45 /* - */ && prevSecond === 45 /* - */) ||\n                (prevFirst === 93 /* ] */ && prevSecond === 93 /* ] */)) {\n              state = STATE_TEXT\n            }\n          }\n          break\n        case STATE_IGNORE_INSTRUCTION:\n          if (c === 62 /* > */) {\n            var prev = data.charCodeAt(pos - 1)\n            if (prev === 63 /* ? */) {\n              state = STATE_TEXT\n            }\n          }\n          break\n        case STATE_TAG:\n          if (c === 62 /* > */) {\n            this._handleTagOpening(endTag, tagName, attrs)\n            tagName = undefined\n            attrs = undefined\n            endTag = undefined\n            selfClosing = undefined\n            state = STATE_TEXT\n            recordStart = pos + 1\n          } else if (c === 47 /* / */) {\n            selfClosing = true\n          } else if (c > 32) {\n            recordStart = pos\n            state = STATE_ATTR_NAME\n          }\n          break\n        case STATE_ATTR_NAME:\n          if (c <= 32 || c === 61 /* = */) {\n            attrName = endRecording()\n            pos--\n            state = STATE_ATTR_EQ\n          }\n          break\n        case STATE_ATTR_EQ:\n          if (c === 61 /* = */) {\n            state = STATE_ATTR_QUOT\n          }\n          break\n        case STATE_ATTR_QUOT:\n          if (c === 34 /* \" */ || c === 39 /* ' */) {\n            attrQuote = c\n            state = STATE_ATTR_VALUE\n            recordStart = pos + 1\n          }\n          break\n        case STATE_ATTR_VALUE:\n          if (c === attrQuote) {\n            var value = unescapeXML(endRecording())\n            attrs[attrName] = value\n            attrName = undefined\n            state = STATE_TAG\n          }\n          break\n      }\n    }\n\n    if (typeof recordStart === 'number' &&\n      recordStart <= data.length) {\n      remainder = data.slice(recordStart)\n      recordStart = 0\n    }\n  }\n  /*\n  var origEmit = this.emit\n  this.emit = function() {\n    console.log('ltx', arguments)\n    origEmit.apply(this, arguments)\n  }\n  */\n}\ninherits(SaxLtx, EventEmitter)\n\nSaxLtx.prototype.end = function (data) {\n  if (data) {\n    this.write(data)\n  }\n\n  /* Uh, yeah */\n  this.write = function () {}\n}\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports, module);\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports', 'module'], factory);\n  }\n}(this, function(exports, module) {\n\n  /**\n   * ANONYMOUS `Mechanism` constructor.\n   *\n   * This class implements the ANONYMOUS SASL mechanism.\n   *\n   * The ANONYMOUS SASL mechanism provides support for permitting anonymous\n   * access to various services\n   *\n   * References:\n   *  - [RFC 4505](http://tools.ietf.org/html/rfc4505)\n   *\n   * @api public\n   */\n  function Mechanism() {\n  }\n  \n  Mechanism.prototype.name = 'ANONYMOUS';\n  Mechanism.prototype.clientFirst = true;\n  \n  /**\n   * Encode a response using optional trace information.\n   *\n   * Options:\n   *  - `trace`  trace information (optional)\n   *\n   * @param {Object} cred\n   * @api public\n   */\n  Mechanism.prototype.response = function(cred) {\n    return cred.trace || '';\n  };\n  \n  /**\n   * Decode a challenge issued by the server.\n   *\n   * @param {String} chal\n   * @api public\n   */\n  Mechanism.prototype.challenge = function(chal) {\n  };\n\n  exports = module.exports = Mechanism;\n  \n}));\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports,\n            module,\n            require('./lib/mechanism'));\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports',\n            'module',\n            './lib/mechanism'], factory);\n  }\n}(this, function(exports, module, Mechanism) {\n\n  exports = module.exports = Mechanism;\n  exports.Mechanism = Mechanism;\n  \n}));\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports, module);\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports', 'module'], factory);\n  }\n}(this, function(exports, module) {\n\n  /**\n   * PLAIN `Mechanism` constructor.\n   *\n   * This class implements the PLAIN SASL mechanism.\n   *\n   * The PLAIN SASL mechanism provides support for exchanging a clear-text\n   * username and password.  This mechanism should not be used without adequate\n   * security provided by an underlying transport layer. \n   *\n   * References:\n   *  - [RFC 4616](http://tools.ietf.org/html/rfc4616)\n   *\n   * @api public\n   */\n  function Mechanism() {\n  }\n  \n  Mechanism.prototype.name = 'PLAIN';\n  Mechanism.prototype.clientFirst = true;\n  \n  /**\n   * Encode a response using given credential.\n   *\n   * Options:\n   *  - `username`\n   *  - `password`\n   *  - `authzid`   authorization identity (optional)\n   *\n   * @param {Object} cred\n   * @api public\n   */\n  Mechanism.prototype.response = function(cred) {\n    var str = '';\n    str += cred.authzid || '';\n    str += '\\0';\n    str += cred.username;\n    str += '\\0';\n    str += cred.password;\n    return str;\n  };\n  \n  /**\n   * Decode a challenge issued by the server.\n   *\n   * @param {String} chal\n   * @return {Mechanism} for chaining\n   * @api public\n   */\n  Mechanism.prototype.challenge = function(chal) {\n    return this;\n  };\n\n  exports = module.exports = Mechanism;\n  \n}));\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports, module);\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports', 'module'], factory);\n  }\n}(this, function(exports, module) {\n  \n  /**\n   * `Factory` constructor.\n   *\n   * @api public\n   */\n  function Factory() {\n    this._mechs = [];\n  }\n  \n  /**\n   * Utilize the given `mech` with optional `name`, overridding the mechanism's\n   * default name.\n   *\n   * Examples:\n   *\n   *     factory.use(FooMechanism);\n   *\n   *     factory.use('XFOO', FooMechanism);\n   *\n   * @param {String|Mechanism} name\n   * @param {Mechanism} mech\n   * @return {Factory} for chaining\n   * @api public\n   */\n  Factory.prototype.use = function(name, mech) {\n    if (!mech) {\n      mech = name;\n      name = mech.prototype.name;\n    }\n    this._mechs.push({ name: name, mech: mech });\n    return this;\n  };\n  \n  /**\n   * Create a new mechanism from supported list of `mechs`.\n   *\n   * If no mechanisms are supported, returns `null`.\n   *\n   * Examples:\n   *\n   *     var mech = factory.create(['FOO', 'BAR']);\n   *\n   * @param {Array} mechs\n   * @return {Mechanism}\n   * @api public\n   */\n  Factory.prototype.create = function(mechs) {\n    for (var i = 0, len = this._mechs.length; i < len; i++) {\n      for (var j = 0, jlen = mechs.length; j < jlen; j++) {\n        var entry = this._mechs[i];\n        if (entry.name == mechs[j]) {\n          return new entry.mech();\n        }\n      }\n    }\n    return null;\n  };\n\n  exports = module.exports = Factory;\n  \n}));\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports,\n            module,\n            require('./lib/factory'));\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports',\n            'module',\n            './lib/factory'], factory);\n  }\n}(this, function(exports, module, Factory) {\n  \n  exports = module.exports = Factory;\n  exports.Factory = Factory;\n  \n}));\n","'use strict'\n\nconst Client = require('./lib/Client')\nconst xml = require('@xmpp/xml')\nconst jid = require('@xmpp/jid')\n\nmodule.exports.Client = Client\nmodule.exports.xml = xml\nmodule.exports.jid = jid\n","'use strict'\n\nconst Connection = require('@xmpp/connection')\n\nclass Client extends Connection {\n  constructor(options) {\n    super(options)\n    this.transports = []\n  }\n\n  send(element, ...args) {\n    if (\n      !element.attrs.xmlns &&\n      (element.is('iq') || element.is('message') || element.is('presence'))\n    ) {\n      element.attrs.xmlns = 'jabber:client' // FIXME no need for TCP/TLS transports\n    }\n    return super.send(element, ...args)\n  }\n\n  connect(uri) {\n    const Transport = this.transports.find(Transport => {\n      try {\n        return Transport.prototype.socketParameters(uri) !== undefined\n      } catch (err) {\n        return false\n      }\n    })\n\n    if (!Transport) {\n      throw new Error('No compatible connection method found.')\n    }\n\n    this.Transport = Transport\n    this.Socket = Transport.prototype.Socket\n    this.Parser = Transport.prototype.Parser\n\n    return super.connect(uri)\n  }\n\n  socketParameters(...args) {\n    return this.Transport.prototype.socketParameters(...args)\n  }\n\n  header(...args) {\n    return this.Transport.prototype.header(...args)\n  }\n\n  headerElement(...args) {\n    return this.Transport.prototype.headerElement(...args)\n  }\n\n  footer(...args) {\n    return this.Transport.prototype.footer(...args)\n  }\n\n  footerElement(...args) {\n    return this.Transport.prototype.footerElement(...args)\n  }\n}\n\nClient.prototype.NS = 'jabber:client'\n\nmodule.exports = Client\n","'use strict'\n\nconst {timeout, EventEmitter, promise} = require('@xmpp/events')\nconst jid = require('@xmpp/jid')\nconst url = require('url')\nconst xml = require('@xmpp/xml')\n\nclass XMPPError extends Error {\n  constructor(condition, text, element) {\n    super(condition + (text ? ` - ${text}` : ''))\n    this.name = 'XMPPError'\n    this.condition = condition\n    this.text = text\n    this.element = element\n  }\n}\n\nclass StreamError extends XMPPError {\n  constructor(...args) {\n    super(...args)\n    this.name = 'StreamError'\n  }\n}\n\n// We ignore url module from the browser bundle to reduce its size\nfunction getHostname(uri) {\n  if (url.parse) {\n    const parsed = url.parse(uri)\n    return parsed.hostname || parsed.pathname\n  }\n  const el = document.createElement('a') // eslint-disable-line no-undef\n  el.href = uri\n  return el.hostname\n}\n\nclass Connection extends EventEmitter {\n  constructor(options) {\n    super()\n    this.domain = ''\n    this.lang = ''\n    this.jid = null\n    this.timeout = 2000\n    this.options = typeof options === 'object' ? options : {}\n    this.plugins = Object.create(null)\n    this.startOptions = null\n    this.openOptions = null\n    this.connectOptions = null\n    this.socketListeners = Object.create(null)\n    this.parserListeners = Object.create(null)\n    this.status = 'offline'\n  }\n\n  _reset() {\n    this.domain = ''\n    this.lang = ''\n    this.jid = null\n    this._detachSocket()\n    this._detachParser()\n    this.socket = null\n  }\n\n  _attachSocket(socket) {\n    const sock = (this.socket = socket)\n    const listeners = this.socketListeners\n    listeners.data = data => {\n      const str = data.toString('utf8')\n      this.emit('input', str)\n      this.parser.write(str)\n    }\n    listeners.close = (...args) => {\n      this._reset()\n      this._status('disconnect', ...args)\n    }\n    listeners.connect = () => {\n      this._status('connect')\n      sock.once('close', listeners.close)\n    }\n    listeners.error = error => {\n      this._reset()\n      if (this.status === 'connecting') {\n        this._status('offline')\n      }\n      this.emit('error', error)\n    }\n    sock.on('data', listeners.data)\n    sock.on('error', listeners.error)\n    sock.on('connect', listeners.connect)\n  }\n\n  _detachSocket() {\n    const listeners = this.socketListeners\n    Object.getOwnPropertyNames(listeners).forEach(k => {\n      this.socket.removeListener(k, listeners[k])\n      delete listeners[k]\n    })\n    delete this.socket\n  }\n\n  _attachParser(p) {\n    const parser = (this.parser = p)\n    const listeners = this.parserListeners\n    listeners.element = element => {\n      if (element.name === 'stream:error') {\n        this.close().then(() => this.disconnect())\n        this.emit(\n          'error',\n          new StreamError(\n            element.children[0].name,\n            element.getChildText(\n              'text',\n              'urn:ietf:params:xml:ns:xmpp-streams'\n            ) || '',\n            element\n          )\n        )\n      }\n      this.emit('element', element)\n      this.emit(this.isStanza(element) ? 'stanza' : 'nonza', element)\n    }\n    listeners.error = error => {\n      this.emit('error', error)\n    }\n    listeners.end = element => {\n      this._status('close', element)\n    }\n    parser.once('error', listeners.error)\n    parser.on('element', listeners.element)\n    parser.on('end', listeners.end)\n  }\n\n  _detachParser() {\n    const listeners = this.parserListeners\n    Object.getOwnPropertyNames(listeners).forEach(k => {\n      this.parser.removeListener(k, listeners[k])\n      delete listeners[k]\n    })\n    delete this.parser\n  }\n\n  _jid(id) {\n    this.jid = jid(id)\n    return this.jid\n  }\n\n  _status(status, ...args) {\n    this.status = status\n    this.emit('status', status, ...args)\n    this.emit(status, ...args)\n  }\n\n  /**\n   * Opens the socket then opens the stream\n   */\n  start(options) {\n    if (this.status !== 'offline') {\n      return Promise.reject(new Error('Connection is not offline'))\n    }\n\n    this.startOptions = options\n\n    if (typeof options === 'string') {\n      options = {uri: options}\n    }\n\n    if (!options.domain) {\n      options.domain = getHostname(options.uri)\n    }\n\n    return Promise.all([\n      this.promise('online'),\n      this.connect(options.uri).then(() => {\n        const {domain, lang} = options\n        return this.open({domain, lang})\n      }),\n    ]).then(([addr]) => addr)\n  }\n\n  /**\n   * Connects the socket\n   */\n  connect(options) {\n    this._status('connecting')\n    this.connectOptions = options\n    return new Promise((resolve, reject) => {\n      this._attachParser(new this.Parser())\n      this._attachSocket(new this.Socket())\n      this.socket.once('error', reject)\n      this.socket.connect(this.socketParameters(options), () => {\n        this.socket.removeListener('error', reject)\n        resolve()\n        // The 'connect' status is emitted by the socket 'connect' listener\n      })\n    })\n  }\n\n  /**\n   * Disconnects the socket\n   * https://xmpp.org/rfcs/rfc6120.html#streams-close\n   * https://tools.ietf.org/html/rfc7395#section-3.6\n   */\n  disconnect(ms = this.timeout) {\n    this._status('disconnecting')\n    this.socket.end()\n    return timeout(promise(this.socket, 'close'), ms)\n    // The 'disconnect' status is emitted by the socket 'close' listener\n  }\n\n  /**\n   * Opens the stream\n   */\n  open(options) {\n    this._status('opening')\n    // Useful for stream-features restart\n    this.openOptions = options\n    if (typeof options === 'string') {\n      options = {domain: options}\n    }\n\n    const {domain, lang} = options\n\n    const headerElement = this.headerElement()\n    headerElement.attrs.to = domain\n    headerElement.attrs['xml:lang'] = lang\n\n    return Promise.all([\n      this.write(this.header(headerElement)),\n      promise(this.parser, 'start').then(el => {\n        // FIXME what about version and xmlns:stream ?\n        if (\n          el.name !== headerElement.name ||\n          el.attrs.xmlns !== headerElement.attrs.xmlns ||\n          el.attrs.from !== headerElement.attrs.to ||\n          !el.attrs.id\n        ) {\n          return this.promise('error')\n        }\n\n        this.domain = domain\n        this.lang = el.attrs['xml:lang']\n        this._status('open', el)\n        return el\n      }),\n    ]).then(([, el]) => el)\n  }\n\n  /**\n   * Closes the stream then closes the socket\n   * https://xmpp.org/rfcs/rfc6120.html#streams-close\n   * https://tools.ietf.org/html/rfc7395#section-3.6\n   */\n  stop() {\n    if (!this.socket) {\n      return Promise.resolve()\n    }\n    return this.close().then(el =>\n      this.disconnect().then(() => {\n        this._status('offline')\n        return el\n      })\n    )\n  }\n\n  /**\n   * Closes the stream and wait for the server to close it\n   * https://xmpp.org/rfcs/rfc6120.html#streams-close\n   * https://tools.ietf.org/html/rfc7395#section-3.6\n   */\n  close(ms = this.timeout) {\n    this._status('closing')\n\n    return Promise.all([\n      timeout(promise(this.parser, 'end'), ms),\n      this.write(this.footer(this.footerElement())),\n    ]).then(([el]) => el)\n    // The 'close' status is emitted by the parser 'end' listener\n  }\n\n  /**\n   * Restart the stream\n   * https://xmpp.org/rfcs/rfc6120.html#streams-negotiation-restart\n   */\n  restart() {\n    this._detachParser()\n    this._attachParser(new this.Parser())\n    this._status('restarting')\n    return this.open(this.openOptions).then(() => {\n      this._status('restart')\n    })\n  }\n\n  send(element) {\n    return this.write(element).then(() => {\n      this.emit('send', element)\n    })\n  }\n\n  sendReceive(element, ms = this.timeout) {\n    return Promise.all([\n      this.send(element),\n      timeout(this.promise('element'), ms),\n    ]).then(([, el]) => el)\n  }\n\n  write(data) {\n    return new Promise((resolve, reject) => {\n      const str = data.toString('utf8')\n      this.socket.write(str, err => {\n        if (err) {\n          return reject(err)\n        }\n        this.emit('output', str)\n        resolve()\n      })\n    })\n  }\n\n  isStanza(element) {\n    const {name} = element\n    const NS = element.attrs.xmlns\n    return (\n      // This.online && FIXME\n      (NS ? NS === this.NS : true) &&\n      (name === 'iq' || name === 'message' || name === 'presence')\n    )\n  }\n\n  isNonza(element) {\n    return !this.isStanza(element)\n  }\n\n  plugin(plugin) {\n    if (!this.plugins[plugin.name]) {\n      this.plugins[plugin.name] = plugin.plugin(this)\n      const p = this.plugins[plugin.name]\n      if (p && p.start) {\n        p.start()\n      } else if (p && p.register) {\n        p.register()\n      }\n    }\n\n    return this.plugins[plugin.name]\n  }\n\n  // Override\n  header(el) {\n    return el.toString()\n  }\n  headerElement() {\n    return new xml.Element('', {\n      version: '1.0',\n      xmlns: this.NS,\n    })\n  }\n  footer(el) {\n    return el.toString()\n  }\n  footerElement() {}\n  socketParameters(uri) {\n    const parsed = url.parse(uri)\n    parsed.port = Number(parsed.port)\n    parsed.host = parsed.hostname\n    return parsed\n  }\n}\n\n// Overrirde\nConnection.prototype.NS = ''\nConnection.prototype.Socket = null\nConnection.prototype.Parser = null\n\nmodule.exports = Connection\nmodule.exports.getHostname = getHostname\nmodule.exports.XMPPError = XMPPError\nmodule.exports.StreamError = StreamError\n","'use strict'\n\nconst timeout = require('./lib/timeout')\nconst delay = require('./lib/delay')\nconst TimeoutError = require('./lib/TimeoutError')\nconst promise = require('./lib/promise')\nconst _EventEmitter = require('./lib/EventEmitter')\n\nexports = module.exports = class EventEmitter extends _EventEmitter {}\nexports.EventEmitter = _EventEmitter\nexports.timeout = timeout\nexports.delay = delay\nexports.TimeoutError = TimeoutError\nexports.promise = promise\n","'use strict'\n\nconst _EventEmitter = require('events')\nconst promiseEvent = require('./promise')\n\nclass EventEmitter {\n  constructor() {\n    this._emitter = new _EventEmitter()\n    this._handlers = Object.create(null)\n  }\n\n  promise(...args) {\n    return promiseEvent(this, ...args)\n  }\n\n  handle(event, handler) {\n    this._handlers[event] = handler\n  }\n\n  delegate(event, ...args) {\n    const handler = this._handlers[event]\n    if (!handler) {\n      throw new Error(`${event} has no handler attached.`)\n    }\n    const promise = handler(...args)\n    if (!(promise instanceof Promise)) {\n      throw new TypeError(`${event} handler must return a promise.`)\n    }\n    return promise\n  }\n\n  isHandled(event) {\n    return Boolean(this._handlers[event])\n  }\n}\n\n;[\n  'on',\n  'addListener',\n  'removeListener',\n  'once',\n  'emit',\n  'listenerCount',\n].forEach(name => {\n  EventEmitter.prototype[name] = function(...args) {\n    this._emitter[name](...args)\n  }\n})\n\nmodule.exports = EventEmitter\n","'use strict'\n\nmodule.exports = class TimeoutError extends Error {\n  constructor(message) {\n    super(message)\n    this.name = 'TimeoutError'\n  }\n}\n","'use strict'\n\nmodule.exports = function delay(timeout) {\n  return new Promise(resolve => {\n    setTimeout(resolve, timeout)\n  })\n}\n","'use strict'\n\nmodule.exports = function promise(EE, event, rejectEvent = 'error') {\n  return new Promise((resolve, reject) => {\n    const cleanup = () => {\n      EE.removeListener(event, onEvent)\n      EE.removeListener(rejectEvent, onError)\n    }\n    function onError(reason) {\n      reject(reason)\n      cleanup()\n    }\n    function onEvent(value) {\n      resolve(value)\n      cleanup()\n    }\n    EE.once(event, onEvent)\n    if (rejectEvent) {\n      EE.once(rejectEvent, onError)\n    }\n  })\n}\n","'use strict'\n\nconst TimeoutError = require('./TimeoutError')\nconst delay = require('./delay')\n\nmodule.exports = function timeout(promise, ms) {\n  return Promise.race([\n    promise,\n    delay(ms).then(() => {\n      throw new TimeoutError()\n    }),\n  ])\n}\n","'use strict'\n\nconst JID = require('./lib/JID')\nconst escaping = require('./lib/escaping')\nconst parse = require('./lib/parse')\n\nfunction jid(...args) {\n  if (!args[1] && !args[2]) {\n    return parse(...args)\n  }\n  return new JID(...args)\n}\n\nexports = module.exports = jid.bind()\nexports.jid = jid\nexports.JID = JID\nexports.equal = function(a, b) {\n  return a.equals(b)\n}\nexports.detectEscape = escaping.detect\nexports.escapeLocal = escaping.escape\nexports.unescapeLocal = escaping.unescape\nexports.parse = parse\n","'use strict'\n\nconst escaping = require('./escaping')\n\n/**\n * JID implements\n * - XMPP addresses according to RFC6122\n * - XEP-0106: JID Escaping\n *\n * @see http://tools.ietf.org/html/rfc6122#section-2\n * @see http://xmpp.org/extensions/xep-0106.html\n */\nclass JID {\n  constructor(local, domain, resource) {\n    if (typeof domain !== 'string' || !domain) {\n      throw new TypeError(`Invalid domain.`)\n    }\n    this.setDomain(domain)\n    this.setLocal(typeof local === 'string' ? local : '')\n    this.setResource(typeof resource === 'string' ? resource : '')\n  }\n\n  [Symbol.toPrimitive](hint) {\n    if (hint === 'number') {\n      return NaN\n    }\n    return this.toString()\n  }\n\n  toString(unescape) {\n    let s = this._domain\n    if (this._local) {\n      s = this.getLocal(unescape) + '@' + s\n    }\n    if (this._resource) {\n      s = s + '/' + this._resource\n    }\n    return s\n  }\n\n  /**\n   * Convenience method to distinguish users\n   * */\n  bare() {\n    if (this._resource) {\n      return new JID(this._local, this._domain, null)\n    }\n    return this\n  }\n\n  /**\n     * Comparison function\n     * */\n  equals(other) {\n    return (\n      this._local === other._local &&\n      this._domain === other._domain &&\n      this._resource === other._resource\n    )\n  }\n\n  /**\n   * http://xmpp.org/rfcs/rfc6122.html#addressing-localpart\n   * */\n  setLocal(local, escape) {\n    escape = escape || escaping.detect(local)\n\n    if (escape) {\n      local = escaping.escape(local)\n    }\n\n    this._local = local && local.toLowerCase()\n    return this\n  }\n  getLocal(unescape) {\n    unescape = unescape || false\n    let local = null\n\n    if (unescape) {\n      local = escaping.unescape(this._local)\n    } else {\n      local = this._local\n    }\n\n    return local\n  }\n\n  /**\n   * http://xmpp.org/rfcs/rfc6122.html#addressing-domain\n   */\n  setDomain(domain) {\n    this._domain = domain.toLowerCase()\n    return this\n  }\n  getDomain() {\n    return this._domain\n  }\n\n  /**\n   * http://xmpp.org/rfcs/rfc6122.html#addressing-resourcepart\n   */\n  setResource(resource) {\n    this._resource = resource\n    return this\n  }\n  getResource() {\n    return this._resource\n  }\n}\n\nObject.defineProperty(JID.prototype, 'local', {\n  get: JID.prototype.getLocal,\n  set: JID.prototype.setLocal,\n})\n\nObject.defineProperty(JID.prototype, 'domain', {\n  get: JID.prototype.getDomain,\n  set: JID.prototype.setDomain,\n})\n\nObject.defineProperty(JID.prototype, 'resource', {\n  get: JID.prototype.getResource,\n  set: JID.prototype.setResource,\n})\n\nmodule.exports = JID\n","'use strict'\n\nmodule.exports.detect = function(local) {\n  if (!local) {\n    return false\n  }\n\n  // Remove all escaped sequences\n  const tmp = local\n    .replace(/\\\\20/g, '')\n    .replace(/\\\\22/g, '')\n    .replace(/\\\\26/g, '')\n    .replace(/\\\\27/g, '')\n    .replace(/\\\\2f/g, '')\n    .replace(/\\\\3a/g, '')\n    .replace(/\\\\3c/g, '')\n    .replace(/\\\\3e/g, '')\n    .replace(/\\\\40/g, '')\n    .replace(/\\\\5c/g, '')\n\n  // Detect if we have unescaped sequences\n  const search = tmp.search(/\\\\| |\"|&|'|\\/|:|<|>|@/g)\n  if (search === -1) {\n    return false\n  }\n  return true\n}\n\n/**\n * Escape the local part of a JID.\n *\n * @see http://xmpp.org/extensions/xep-0106.html\n * @param String local local part of a jid\n * @return An escaped local part\n */\nmodule.exports.escape = function(local) {\n  if (local === null) {\n    return null\n  }\n\n  return local\n    .replace(/^\\s+|\\s+$/g, '')\n    .replace(/\\\\/g, '\\\\5c')\n    .replace(/ /g, '\\\\20')\n    .replace(/\"/g, '\\\\22')\n    .replace(/&/g, '\\\\26')\n    .replace(/'/g, '\\\\27')\n    .replace(/\\//g, '\\\\2f')\n    .replace(/:/g, '\\\\3a')\n    .replace(/</g, '\\\\3c')\n    .replace(/>/g, '\\\\3e')\n    .replace(/@/g, '\\\\40')\n    .replace(/\\3a/g, '\\u0005c3a')\n}\n\n/**\n * Unescape a local part of a JID.\n *\n * @see http://xmpp.org/extensions/xep-0106.html\n * @param String local local part of a jid\n * @return unescaped local part\n */\nmodule.exports.unescape = function(local) {\n  if (local === null) {\n    return null\n  }\n\n  return local\n    .replace(/\\\\20/g, ' ')\n    .replace(/\\\\22/g, '\"')\n    .replace(/\\\\26/g, '&')\n    .replace(/\\\\27/g, \"'\")\n    .replace(/\\\\2f/g, '/')\n    .replace(/\\\\3a/g, ':')\n    .replace(/\\\\3c/g, '<')\n    .replace(/\\\\3e/g, '>')\n    .replace(/\\\\40/g, '@')\n    .replace(/\\\\5c/g, '\\\\')\n}\n","'use strict'\n\nconst JID = require('../lib/JID')\n\nmodule.exports = function parse(s) {\n  let local\n  let resource\n\n  const resourceStart = s.indexOf('/')\n  if (resourceStart !== -1) {\n    resource = s.substr(resourceStart + 1)\n    s = s.substr(0, resourceStart)\n  }\n\n  const atStart = s.indexOf('@')\n  if (atStart !== -1) {\n    local = s.substr(0, atStart)\n    s = s.substr(atStart + 1)\n  }\n\n  return new JID(local, s, resource)\n}\n","'use strict'\n\nconst _Plugin = require('./lib/Plugin')\nconst jid = require('@xmpp/jid')\nconst xml = require('@xmpp/xml')\n\nfunction plugin(name, props, dependencies = []) {\n  class Plugin extends _Plugin {}\n  Object.assign(Plugin.prototype, props)\n\n  return {\n    name,\n    plugin(entity) {\n      const p = new Plugin()\n      p.attach(entity)\n\n      const plugins = {}\n      dependencies.forEach(dep => {\n        plugins[dep.name] = entity.plugin(dep)\n      })\n      p.plugins = plugins\n\n      return p\n    },\n    unplug() {\n      // FIXME\n    },\n  }\n}\n\nmodule.exports = plugin.bind(undefined)\nmodule.exports.plugin = plugin\nmodule.exports.Plugin = _Plugin\nmodule.exports.jid = jid\nmodule.exports.xml = xml\n","'use strict'\n\nconst EventEmitter = require('@xmpp/events')\n\nclass Plugin extends EventEmitter {\n  attach(entity) {\n    this.entity = entity\n  }\n\n  detach() {\n    delete this.entity\n  }\n\n  // Override\n  start() {}\n  stop() {}\n}\n\nmodule.exports = Plugin\n","'use strict'\n\nconst {plugin, xml} = require('@xmpp/plugin')\nconst streamfeatures = require('../stream-features')\nconst iqCaller = require('../iq-caller')\n\n/*\n * References\n * https://xmpp.org/rfcs/rfc6120.html#bind\n */\n\nconst NS = 'urn:ietf:params:xml:ns:xmpp-bind'\n\nfunction makeBindElement(resource) {\n  return xml('bind', {xmlns: NS}, resource && xml('resource', {}, resource))\n}\n\nfunction match(features) {\n  return features.getChild('bind', NS)\n}\n\nmodule.exports = plugin(\n  'bind',\n  {\n    start() {\n      const streamFeature = {\n        name: 'bind',\n        priority: 2500,\n        match,\n        run: () => this.handleFeature(),\n      }\n      this.plugins['stream-features'].add(streamFeature)\n    },\n    bind(resource) {\n      this.entity._status('binding')\n      return this.plugins['iq-caller']\n        .set(makeBindElement(resource))\n        .then(result => {\n          this.entity._jid(result.getChildText('jid'))\n          this.entity._status('bound')\n        })\n    },\n    handleFeature() {\n      const {entity} = this\n      entity._status('bind')\n      return entity.isHandled('bind')\n        ? entity.delegate('bind', resource => this.bind(resource))\n        : this.bind()\n    },\n  },\n  [streamfeatures, iqCaller]\n)\n","'use strict'\n\nconst {plugin, xml} = require('@xmpp/plugin')\n\nmodule.exports = plugin('iq-caller', {\n  start() {\n    this.handlers = new Map()\n    this.handler = stanza => {\n      if (!this.match(stanza)) {\n        return\n      }\n\n      const {id} = stanza.attrs\n\n      const handler = this.handlers.get(id)\n      if (!handler) {\n        return\n      }\n\n      if (stanza.attrs.type === 'error') {\n        handler[1](stanza.getChild('error'))\n      } else {\n        handler[0](stanza.children[0])\n      }\n      this.handlers.delete(id)\n    }\n    this.entity.on('element', this.handler)\n  },\n  stop() {\n    this.entity.removeListener('element', this.handler)\n  },\n  id() {\n    let id\n    while (!id) {\n      id = Math.random()\n        .toString(36)\n        .substr(2, 12)\n    }\n    return id\n  },\n  match(stanza) {\n    return (\n      stanza.name === 'iq' &&\n      (stanza.attrs.type === 'error' || stanza.attrs.type === 'result')\n    )\n  },\n  get(el, ...args) {\n    const iq = xml('iq', {type: 'get'})\n    iq.append(el)\n    return this.request(iq, ...args)\n  },\n  set(el, ...args) {\n    const iq = xml('iq', {type: 'set'})\n    iq.append(el)\n    return this.request(iq, ...args)\n  },\n  request(stanza, to) {\n    return new Promise((resolve, reject) => {\n      if (to && typeof to === 'string' && !stanza.attrs.to) {\n        stanza.attrs.to = to\n      }\n      if (!stanza.attrs.id) {\n        stanza.attrs.id = this.id()\n      }\n\n      this.handlers.set(stanza.attrs.id, [resolve, reject])\n\n      this.entity.send(stanza)\n    })\n  },\n})\n","'use strict'\n\nconst plugin = require('@xmpp/plugin')\n\nmodule.exports = plugin('reconnect', {\n  delay: 1000,\n\n  reconnect() {\n    const {entity} = this\n    this.emit('reconnecting')\n    this._timeout = setTimeout(() => {\n      if (entity.status === 'offline') {\n        return\n      }\n      // Allow calling start() even though status is not offline\n      // reset status property right after\n      const {status} = entity\n      entity.status = 'offline'\n\n      entity\n        .start(entity.startOptions)\n        .then(() => {\n          this.emit('reconnected')\n        })\n        .catch(() => this.reconnect())\n        .catch(err => {\n          this.emit('error', err)\n        })\n      entity.status = status\n    }, this.delay)\n  },\n\n  stopped() {\n    const {entity, listeners, _timeout} = this\n    entity.removeListener('disconnect', listeners.disconnect)\n    clearTimeout(_timeout)\n  },\n\n  start() {\n    const listeners = {}\n    listeners.disconnect = () => {\n      this.reconnect()\n    }\n    listeners.online = () => {\n      this.entity.on('disconnect', listeners.disconnect)\n    }\n    this.listeners = listeners\n    this.entity.once('online', listeners.online)\n  },\n\n  stop() {\n    this.stopped()\n    this.entity.removeListener('online', this.listeners.online)\n  },\n})\n","'use strict'\n\nconst mech = require('sasl-anonymous')\nconst sasl = require('../sasl')\n\nmodule.exports.name = 'sasl-anonymous'\nmodule.exports.plugin = function plugin(entity) {\n  const SASL = entity.plugin(sasl)\n  SASL.use(mech)\n  return {\n    entity,\n  }\n}\n","'use strict'\n\nconst mech = require('sasl-plain')\nconst sasl = require('../sasl')\n\nmodule.exports.name = 'sasl-plain'\nmodule.exports.plugin = function plugin(entity) {\n  const SASL = entity.plugin(sasl)\n  SASL.use(mech)\n  return {\n    entity,\n  }\n}\n","'use strict'\n\nconst {encode, decode} = require('./lib/b64')\nconst plugin = require('@xmpp/plugin')\nconst xml = require('@xmpp/xml')\nconst streamFeatures = require('../stream-features')\nconst {XMPPError} = require('@xmpp/connection')\nconst SASLFactory = require('saslmechanisms')\n\nconst NS = 'urn:ietf:params:xml:ns:xmpp-sasl'\n\nclass SASLError extends XMPPError {\n  constructor(...args) {\n    super(...args)\n    this.name = 'SASLError'\n  }\n}\n\nfunction match(features) {\n  return features.getChild('mechanisms', NS)\n}\n\nfunction getMechanismNames(features) {\n  return features.getChild('mechanisms', NS).children.map(el => el.text())\n}\n\nmodule.exports = plugin(\n  'sasl',\n  {\n    start() {\n      this.SASL = new SASLFactory()\n      this.streamFeature = {\n        name: 'sasl',\n        priority: 1000,\n        match,\n        restart: true,\n        run: (entity, features) => {\n          return this.gotFeatures(features)\n        },\n      }\n      this.plugins['stream-features'].add(this.streamFeature)\n    },\n\n    stop() {\n      delete this.SASL\n      this.plugins['stream-features'].remove(this.streamFeature)\n      delete this.streamFeature\n      delete this.mech\n    },\n\n    use(...args) {\n      this.SASL.use(...args)\n    },\n\n    gotFeatures(features) {\n      const offered = getMechanismNames(features)\n      const usable = this.getUsableMechanisms(offered)\n      // FIXME const available = this.getAvailableMechanisms()\n\n      return Promise.resolve(this.getMechanism(usable)).then(mech => {\n        this.mech = mech\n        return this.handleMechanism(mech, features)\n      })\n    },\n\n    handleMechanism(mech, features) {\n      this.entity._status('authenticate')\n\n      if (mech === 'ANONYMOUS') {\n        return this.authenticate(mech, {}, features)\n      }\n\n      return this.entity.delegate(\n        'authenticate',\n        (username, password) => {\n          return this.authenticate(mech, {username, password}, features)\n        },\n        mech\n      )\n    },\n\n    getAvailableMechanisms() {\n      return this.SASL._mechs.map(({name}) => name)\n    },\n\n    getUsableMechanisms(mechs) {\n      const supported = this.getAvailableMechanisms()\n      return mechs.filter(mech => {\n        return supported.indexOf(mech) > -1\n      })\n    },\n\n    getMechanism(usable) {\n      return usable[0] // FIXME prefer SHA-1, ... maybe order usable, available, ... by preferred?\n    },\n\n    findMechanism(name) {\n      return this.SASL.create([name])\n    },\n\n    authenticate(mechname, credentials) {\n      const mech = this.findMechanism(mechname)\n      if (!mech) {\n        return Promise.reject(new Error('no compatible mechanism'))\n      }\n\n      const {domain} = this.entity.options\n      const creds = Object.assign(\n        {\n          username: null,\n          password: null,\n          server: domain,\n          host: domain,\n          realm: domain,\n          serviceType: 'xmpp',\n          serviceName: domain,\n        },\n        credentials\n      )\n\n      this.entity._status('authenticating')\n\n      return new Promise((resolve, reject) => {\n        const handler = element => {\n          if (element.attrs.xmlns !== NS) {\n            return\n          }\n\n          if (element.name === 'challenge') {\n            mech.challenge(decode(element.text()))\n            const resp = mech.response(creds)\n            this.entity.send(\n              xml(\n                'response',\n                {xmlns: NS, mechanism: mech.name},\n                typeof resp === 'string' ? encode(resp) : ''\n              )\n            )\n            return\n          }\n\n          if (element.name === 'failure') {\n            reject(\n              new SASLError(\n                element.children[0].name,\n                element.getChildText('text') || '',\n                element\n              )\n            )\n          } else if (element.name === 'success') {\n            resolve()\n            this.entity._status('authenticated')\n          }\n\n          this.entity.removeListener('nonza', handler)\n        }\n        this.entity.on('nonza', handler)\n\n        if (mech.clientFirst) {\n          this.entity.send(\n            xml(\n              'auth',\n              {xmlns: NS, mechanism: mech.name},\n              encode(mech.response(creds))\n            )\n          )\n        }\n      })\n    },\n  },\n  [streamFeatures]\n)\n","'use strict'\n\nmodule.exports.encode = function encode(string) {\n  if (!global.Buffer) {\n    return global.btoa(string)\n  }\n  return Buffer.from(string, 'utf8').toString('base64')\n}\n\nmodule.exports.decode = function decode(string) {\n  if (!global.Buffer) {\n    return global.atob(string)\n  }\n  return Buffer.from(string, 'base64').toString('utf8')\n}\n","'use strict'\n\nconst {plugin, xml} = require('@xmpp/plugin')\nconst streamfeatures = require('../stream-features')\nconst iqCaller = require('../iq-caller')\n\nconst NS = 'urn:ietf:params:xml:ns:xmpp-session'\n\nfunction match(features) {\n  const feature = features.getChild('session', NS)\n  return Boolean(feature) && !feature.getChild('optional')\n}\n\nmodule.exports = plugin(\n  'session-establishment',\n  {\n    start() {\n      const streamFeature = {\n        name: 'session-establishment',\n        priority: 2000,\n        match,\n        run: () => this.establishSession(),\n      }\n      this.plugins['stream-features'].add(streamFeature)\n    },\n    establishSession() {\n      return this.entity.plugins['iq-caller'].set(\n        xml('session', 'urn:ietf:params:xml:ns:xmpp-session')\n      )\n    },\n  },\n  [streamfeatures, iqCaller]\n)\nmodule.exports.match = match\n","'use strict'\n\n/**\n * References\n * https://xmpp.org/rfcs/rfc6120.html#streams-negotiation Stream Negotiation\n * https://xmpp.org/extensions/xep-0170.html XEP-0170: Recommended Order of Stream Feature Negotiation\n * https://xmpp.org/registrar/stream-features.html XML Stream Features\n */\n\nconst plugin = require('@xmpp/plugin')\n\nmodule.exports = plugin('stream-features', {\n  start() {\n    this.features = []\n\n    const {entity} = this\n    this.handler = el => {\n      if (el.name !== 'stream:features') {\n        return\n      }\n\n      const streamFeatures = this.selectFeatures(el)\n      if (streamFeatures.length === 0) {\n        return\n      }\n\n      function iterate(c) {\n        const feature = streamFeatures[c]\n        return feature\n          .run(entity, el)\n          .then(() => {\n            if (feature.restart) {\n              return entity.restart()\n            } else if (c === streamFeatures.length - 1) {\n              if (entity.jid) entity._status('online', entity.jid)\n            } else {\n              iterate(c + 1)\n            }\n          })\n          .catch(err => entity.emit('error', err))\n      }\n\n      return iterate(0)\n    }\n\n    entity.on('nonza', this.handler)\n  },\n\n  stop() {\n    delete this.features\n    this.entity.off('nonza', this.handler)\n    delete this.handler\n  },\n\n  selectFeatures(el) {\n    return this.features\n      .filter(f => f.match(el, this.entity) && typeof f.priority === 'number')\n      .sort((a, b) => {\n        return a.priority < b.priority\n      })\n  },\n\n  add({name, priority, run, match, restart}) {\n    this.features.push({name, priority, run, match, restart})\n  },\n})\n","'use strict'\n\nconst ConnectionWebSocket = require('./lib/Connection')\n\nmodule.exports.name = 'websocket'\nmodule.exports.plugin = function plugin(entity) {\n  entity.transports.push(ConnectionWebSocket)\n  return {\n    entity,\n  }\n}\n","'use strict'\n\nconst Socket = require('./Socket')\nconst Connection = require('@xmpp/connection')\nconst xml = require('@xmpp/xml')\nconst FramedParser = require('./FramedParser')\n\nconst NS_FRAMING = 'urn:ietf:params:xml:ns:xmpp-framing'\n\n/* References\n * WebSocket protocol https://tools.ietf.org/html/rfc6455\n * WebSocket Web API https://html.spec.whatwg.org/multipage/comms.html#network\n * XMPP over WebSocket https://tools.ietf.org/html/rfc7395\n*/\n\nclass ConnectionWebSocket extends Connection {\n  // https://tools.ietf.org/html/rfc7395#section-3.6\n  footerElement() {\n    return new xml.Element('close', {\n      xmlns: NS_FRAMING,\n    })\n  }\n\n  // https://tools.ietf.org/html/rfc7395#section-3.4\n  headerElement() {\n    const el = super.headerElement()\n    el.name = 'open'\n    el.attrs.xmlns = NS_FRAMING\n    return el\n  }\n\n  socketParameters(uri) {\n    return uri.match(/^wss?:\\/\\//) ? uri : undefined\n  }\n}\n\nConnectionWebSocket.prototype.Socket = Socket\nConnectionWebSocket.prototype.NS = 'jabber:client'\nConnectionWebSocket.prototype.Parser = FramedParser\n\nmodule.exports = ConnectionWebSocket\n","'use strict'\n\nconst {Parser} = require('@xmpp/xml')\n\nmodule.exports = class FramedParser extends Parser {\n  onStartElement() {}\n  onEndElement(element, length) {\n    if (length === 1) {\n      if (element.is('open', 'urn:ietf:params:xml:ns:xmpp-framing')) {\n        this.emit('start', element)\n      } else if (element.is('close', 'urn:ietf:params:xml:ns:xmpp-framing')) {\n        this.emit('end', element)\n      } else {\n        this.emit('element', element)\n      }\n    }\n  }\n}\n","'use strict'\n\nconst WS = require('ws')\nconst WebSocket = global.WebSocket || WS\nconst EventEmitter = require('events')\n\nclass Socket extends EventEmitter {\n  constructor() {\n    super()\n    this.listeners = Object.create(null)\n  }\n\n  connect(url, fn) {\n    this.url = url\n    this._attachSocket(new WebSocket(url, ['xmpp']), fn)\n  }\n\n  _attachSocket(socket, fn) {\n    const sock = (this.socket = socket)\n    const {listeners} = this\n    listeners.open = () => {\n      this.emit('connect')\n      if (fn) {\n        fn()\n      }\n    }\n    listeners.message = ({data}) => this.emit('data', data)\n    listeners.error = err => {\n      this.emit(\n        'error',\n        err instanceof Error ? err : new Error(`connection error ${this.url}`)\n      )\n    }\n    listeners.close = ({code, reason}) => {\n      this._detachSocket()\n      this.emit('close', {code, reason})\n    }\n\n    sock.addEventListener('open', listeners.open)\n    sock.addEventListener('message', listeners.message)\n    sock.addEventListener('error', listeners.error)\n    sock.addEventListener('close', listeners.close)\n  }\n\n  _detachSocket() {\n    delete this.url\n    const {socket, listeners} = this\n    Object.getOwnPropertyNames(listeners).forEach(k => {\n      socket.removeEventListener(k, listeners[k])\n      delete listeners[k]\n    })\n    delete this.socket\n  }\n\n  end() {\n    this.socket.close()\n  }\n\n  write(data, fn) {\n    if (WebSocket === WS) {\n      this.socket.send(data, fn)\n    } else {\n      this.socket.send(data)\n      fn()\n    }\n  }\n}\n\nmodule.exports = Socket\n","'use strict'\n\nconst x = require('./lib/x')\nconst Element = require('./lib/Element')\nconst Parser = require('./lib/Parser')\nconst {\n  escapeXML,\n  unescapeXML,\n  escapeXMLText,\n  unescapeXMLText,\n} = require('ltx/lib/escape')\n\nfunction xml(...args) {\n  return x(...args)\n}\n\nexports = module.exports = xml\n\nObject.assign(exports, {\n  x,\n  Element,\n  Parser,\n  escapeXML,\n  unescapeXML,\n  escapeXMLText,\n  unescapeXMLText,\n})\n","'use strict'\n\nconst _Element = require('ltx/lib/Element')\n\nclass Element extends _Element {\n  append(nodes) {\n    nodes = Array.isArray(nodes) ? nodes : [nodes]\n    nodes.forEach(node => {\n      this.children.push(node)\n      if (typeof node === 'object') {\n        node.parent = this\n      }\n    })\n  }\n\n  prepend(nodes) {\n    nodes = Array.isArray(nodes) ? nodes : [nodes]\n    nodes.forEach(node => {\n      this.children.unshift(node)\n      if (typeof node === 'object') {\n        node.parent = this\n      }\n    })\n  }\n}\n\nmodule.exports = Element\n","'use strict'\n\nconst LtxParser = require('ltx/lib/parsers/ltx')\nconst Element = require('./Element')\nconst EventEmitter = require('events')\n\nclass XMLError extends Error {\n  constructor(...args) {\n    super(...args)\n    this.name = 'XMLError'\n  }\n}\n\nclass Parser extends EventEmitter {\n  constructor() {\n    super()\n    const parser = new LtxParser()\n    const stack = []\n    let cursor\n\n    parser.on('startElement', (name, attrs) => {\n      const child = new Element(name, attrs)\n      if (cursor) {\n        cursor.append(child)\n      }\n      this.onStartElement(child, cursor)\n      this.emit('startElement', child)\n      stack.push(cursor)\n      cursor = child\n    })\n    parser.on('endElement', name => {\n      if (name === cursor.name) {\n        this.onEndElement(cursor, stack.length)\n        this.emit('endElement', cursor)\n        cursor = stack.pop()\n      } else {\n        // <foo></bar>\n        this.emit('error', new XMLError(`${cursor.name} must be closed.`))\n      }\n    })\n\n    parser.on('text', str => {\n      this.onText(str, cursor)\n    })\n    this.parser = parser\n  }\n  onStartElement(element, cursor) {\n    if (!cursor) {\n      this.emit('start', element)\n    }\n  }\n  onEndElement(element, length) {\n    if (length === 2) {\n      this.emit('element', element)\n    } else if (length === 1) {\n      this.emit('end', element)\n    }\n  }\n  onText(str, element) {\n    if (!element) {\n      this.emit('error', new XMLError(`${str} must be a child.`))\n      return\n    }\n    element.t(str)\n  }\n  write(data) {\n    this.parser.write(data)\n  }\n  end(data) {\n    if (data) {\n      this.parser.write(data)\n    }\n  }\n}\n\nParser.XMLError = XMLError\n\nmodule.exports = Parser\n","'use strict'\n\nconst Element = require('./Element')\n\nfunction append(el, child) {\n  if (child instanceof Element) {\n    el.append(child)\n  } else if (Array.isArray(child)) {\n    child.forEach(c => append(el, c))\n  } else if (child !== null && child !== undefined) {\n    el.append(String(child))\n  }\n}\n\nfunction x(name, attrs, ...children) {\n  const el = new Element(name, attrs)\n  for (let i = 0; i < children.length; i++) {\n    append(el, children[i])\n  }\n  return el\n}\n\nmodule.exports = x\n","'use strict'\n\nconst Client = require('./lib/Client')\nconst {xml, jid} = require('@xmpp/client-core')\n\nmodule.exports.Client = Client\nmodule.exports.xml = xml\nmodule.exports.jid = jid\n","'use strict'\n\nconst ClientCore = require('@xmpp/client-core').Client\nconst plugins = require('./plugins')\n\nclass Client extends ClientCore {\n  constructor(...args) {\n    super(...args)\n    Object.keys(plugins).forEach(name => {\n      const plugin = plugins[name]\n      // Ignore browserify stubs\n      if (!plugin.plugin) {\n        return\n      }\n      this.plugin(plugin)\n    })\n  }\n}\n\nmodule.exports = Client\n","'use strict'\n\nexports['stream-features'] = require('@xmpp/plugins/stream-features')\nexports.bind = require('@xmpp/plugins/bind')\nexports.sasl = require('@xmpp/plugins/sasl')\nexports['sasl-plain'] = require('@xmpp/plugins/sasl-plain')\nexports['sasl-anonymous'] = require('@xmpp/plugins/sasl-anonymous')\nexports.websocket = require('@xmpp/plugins/websocket')\nexports.tcp = require('@xmpp/plugins/tcp')\nexports.tls = require('@xmpp/plugins/tls')\nexports.reconnect = require('@xmpp/plugins/reconnect')\nexports.starttls = require('@xmpp/plugins/starttls')\nexports[\n  'session-establishment'\n] = require('@xmpp/plugins/session-establishment')\n"]}